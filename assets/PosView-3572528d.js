import{d as W,r as S,c as N,o as p,a as x,b as e,w as L,v as ie,F as U,e as J,t as c,n as E,f as A,g as Y,m as ze,u as Le,h as H,i as Ce,j as Ue,k as Be,l as He,p as Je,q as Ke,s as $e,x as Ge,y as Qe,z as Ye,A as Se,B as le,C as R,D as We,E as Xe,G as me,H as Ze,T as et,I as tt}from"./index-64b2fb6b.js";import{_ as st}from"./InvoiceModal.vue_vue_type_script_setup_true_lang-90350195.js";import{_ as ot}from"./_plugin-vue_export-helper-c27b6911.js";import"./BarcodeDisplay.vue_vue_type_script_setup_true_lang-89931c48.js";import"./_commonjsHelpers-725317a4.js";import"./print-175f5ba3.js";const nt={class:"rounded-lg p-4 flex flex-col h-full dark-panel"},lt={class:"mb-4 flex items-center sticky top-0 z-10 dark-panel"},it={class:"flex-1 overflow-y-auto pr-2"},at={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},dt=["src","alt"],ut={class:"mt-2 flex-1"},rt={class:"text-sm font-medium text-slate-100"},ct={class:"mt-1 text-sm text-slate-300"},vt=["disabled","onClick"],mt=W({__name:"ProductList",props:{products:{},disabled:{type:Boolean}},emits:["add"],setup(C,{emit:M}){const k=C,D=M,w=S(""),b=N(()=>{const v=w.value.trim().toLowerCase();return v?k.products.filter(d=>d.name.toLowerCase().includes(v)):k.products});return(v,d)=>(p(),x("div",nt,[e("div",lt,[L(e("input",{"onUpdate:modelValue":d[0]||(d[0]=g=>w.value=g),type:"text",placeholder:"Search products...",class:"w-full input-field"},null,512),[[ie,w.value]])]),e("div",it,[e("div",at,[(p(!0),x(U,null,J(b.value,g=>(p(),x("div",{key:g.id,class:"group flex flex-col rounded-lg p-3 dark-panel transition hover:shadow-md max-w-full"},[e("img",{src:g.image,alt:g.name,class:"w-full aspect-[3/2] rounded-md object-cover"},null,8,dt),e("div",ut,[e("div",rt,c(g.name),1),e("div",ct,"₹"+c(g.price),1),e("div",{class:E(["mt-1 text-xs",g.stock>0?"text-slate-400":"text-red-500 font-medium"])},c(g.stock>0?"Stock: "+g.stock:"Out of Stock"),3)]),e("button",{disabled:g.stock===0||k.disabled,onClick:_=>D("add",g),class:"mt-3 rounded-md bg-indigo-600 px-3 py-3 sm:py-2 text-sm font-medium text-slate-100 disabled:bg-gray-700 disabled:cursor-not-allowed w-full sm:w-auto",style:{"min-height":"44px"}}," Add to Cart ",8,vt)]))),128))])])]))}}),pt={class:"rounded-lg p-4 dark-panel"},ft={key:0,class:"text-sm text-slate-400"},xt={key:1,class:"-mx-2 divide-y divide-gray-100 dark:divide-slate-700"},gt=["onClick"],bt={class:"flex items-center gap-3"},kt=["src","alt"],yt={class:"flex-1"},ht={class:"text-sm font-medium text-slate-100"},Dt={class:"text-xs text-slate-400"},wt={class:"text-xs text-slate-400"},Ct={class:"text-xs font-semibold text-slate-100"},$t={class:"flex flex-col items-end gap-2"},St=["max","value","onInput","disabled"],_t=["onClick","disabled"],Mt={class:"grid grid-cols-2 gap-2"},Tt=["value","onChange","disabled"],It=["value","onInput","disabled"],Vt={key:2,class:"mt-4 space-y-3 rounded-lg p-4 dark-panel"},Nt={class:"flex items-center justify-between text-sm"},Ft={class:"font-medium text-slate-100 dark:text-slate-100"},At={class:"rounded-md p-3 dark-panel"},qt={class:"flex items-center justify-between gap-4 text-sm"},Rt={class:"flex items-center gap-2"},jt=["value","disabled"],Et=["value","disabled"],Ot={class:"mt-2 text-right text-xs text-slate-400"},Pt={class:"flex items-center justify-between text-base font-semibold text-slate-100 dark:text-slate-100"},zt=["disabled"],Lt=["disabled"],_e=W({__name:"Cart",props:{items:{},subtotal:{},invoiceDiscountMode:{},invoiceDiscountValue:{},invoiceDiscountAmount:{},grandTotal:{},selectedId:{},disabled:{type:Boolean}},emits:["updateQty","remove","checkout","hold","select","updateItemDiscount","updateInvoiceDiscountMode","updateInvoiceDiscountValue"],setup(C,{emit:M}){const k=C,D=M,w=N(()=>k.items.length===0);function b(_,n){D("updateItemDiscount",{id:_,mode:n})}function v(_,n){const u=Number(n);D("updateItemDiscount",{id:_,value:Number.isNaN(u)?0:u})}function d(_){const n=_.target.value;D("updateInvoiceDiscountMode",n)}function g(_){const n=Number(_.target.value);D("updateInvoiceDiscountValue",Number.isNaN(n)?0:n)}return(_,n)=>(p(),x("div",pt,[n[14]||(n[14]=e("h2",{class:"mb-4 text-lg font-semibold text-slate-100"},"Cart",-1)),w.value?(p(),x("div",ft,"Your cart is empty.")):(p(),x("ul",xt,[(p(!0),x(U,null,J(k.items,u=>(p(),x("li",{key:u.id,class:E(["flex flex-col gap-2 px-2 py-3 rounded-md transition-colors",C.selectedId===u.id?"dark:bg-[rgba(59,130,246,0.18)] dark:ring-2 dark:ring-indigo-500 bg-[rgba(59,130,246,0.08)] ring-2 ring-indigo-300":""]),onClick:$=>D("select",u.id)},[e("div",bt,[e("img",{src:u.image,alt:u.name,class:"h-12 w-12 rounded object-cover"},null,8,kt),e("div",yt,[e("div",ht,c(u.name),1),e("div",Dt,"Price Rs "+c(u.price.toFixed(2))+" × Qty "+c(u.quantity),1),e("div",wt,"Line Discount Rs "+c(u.lineDiscount.toFixed(2)),1),e("div",Ct,"Line Total Rs "+c(u.lineTotal.toFixed(2)),1)]),e("div",$t,[e("input",{type:"number",min:"1",max:u.stock,value:u.quantity,onClick:n[0]||(n[0]=Y(()=>{},["stop"])),onInput:$=>D("updateQty",u.id,Number($.target.value)),class:"w-20 rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,St),e("button",{onClick:Y($=>D("remove",u.id),["stop"]),class:"rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-xs text-slate-200 hover:dark-panel dark:border-slate-600/60 dark:text-slate-200 dark:hover:bg-slate-700/40",title:"Delete",disabled:k.disabled}," Remove ",8,_t)])]),e("div",Mt,[e("div",null,[n[8]||(n[8]=e("label",{class:"block text-xs text-slate-300 dark:text-slate-300"},"Discount Type",-1)),e("select",{value:u.discountMode,onClick:n[1]||(n[1]=Y(()=>{},["stop"])),onChange:$=>b(u.id,$.target.value),class:"mt-1 w-full rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},[...n[7]||(n[7]=[e("option",{value:"flat"},"Flat",-1),e("option",{value:"percent"},"Percent",-1)])],40,Tt)]),e("div",null,[n[9]||(n[9]=e("label",{class:"block text-xs text-slate-300 dark:text-slate-300"},"Discount Value",-1)),e("input",{value:u.discountValue,type:"number",min:"0",step:"0.01",onClick:n[2]||(n[2]=Y(()=>{},["stop"])),onInput:$=>v(u.id,$.target.value),class:"mt-1 w-full rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,It)])])],10,gt))),128))])),w.value?A("",!0):(p(),x("div",Vt,[e("div",Nt,[n[10]||(n[10]=e("span",{class:"text-slate-300 dark:text-slate-300"},"Subtotal",-1)),e("span",Ft,"Rs "+c(C.subtotal.toFixed(2)),1)]),e("div",At,[e("div",qt,[n[12]||(n[12]=e("span",{class:"text-slate-300 dark:text-slate-300"},"Invoice Discount",-1)),e("div",Rt,[e("select",{value:C.invoiceDiscountMode,onChange:n[3]||(n[3]=u=>d(u)),class:"rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},[...n[11]||(n[11]=[e("option",{value:"flat"},"Flat",-1),e("option",{value:"percent"},"Percent",-1)])],40,jt),e("input",{value:C.invoiceDiscountValue,type:"number",min:"0",step:"0.01",onInput:n[4]||(n[4]=u=>g(u)),class:"w-24 rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,Et)])]),e("div",Ot,"Discount Amount: Rs "+c(C.invoiceDiscountAmount.toFixed(2)),1)]),e("div",Pt,[n[13]||(n[13]=e("span",null,"Grand Total",-1)),e("span",null,"Rs "+c(C.grandTotal.toFixed(2)),1)])])),e("button",{disabled:w.value||k.disabled,onClick:n[5]||(n[5]=u=>D("checkout")),class:"mt-4 w-full rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-slate-100 disabled:cursor-not-allowed disabled:bg-gray-600",title:"Checkout"}," Checkout ",8,zt),e("button",{disabled:w.value||k.disabled,onClick:n[6]||(n[6]=u=>D("hold")),class:"mt-2 w-full rounded-md border border-transparent px-4 py-2 text-sm font-medium text-slate-200 hover:bg-[rgba(255,255,255,0.02)] disabled:cursor-not-allowed disabled:opacity-60",title:"Hold Sale"}," Hold Sale ",8,Lt)]))}}),Ut={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4"},Bt={class:"w-full max-w-lg rounded-lg dark-panel"},Ht={class:"flex items-center justify-between border-b px-4 py-3"},Jt={class:"max-h-[60vh] overflow-y-auto p-4"},Kt={class:"text-sm text-slate-300"},Gt={class:"mt-3 divide-y divide-gray-100"},Qt={class:"flex items-center justify-between"},Yt={class:"text-slate-200"},Wt={class:"font-medium text-slate-100"},Xt={class:"flex justify-between text-xs text-slate-400"},Zt={class:"mt-4 space-y-2 text-sm"},es={class:"flex items-center justify-between"},ts={class:"font-medium text-slate-100"},ss={class:"flex items-center justify-between"},os={class:"font-medium text-slate-100"},ns={class:"flex items-center justify-between"},ls={class:"text-slate-300"},is={class:"font-medium text-slate-100"},as={class:"mt-3 flex items-center justify-between border-t pt-3"},ds={class:"text-base font-semibold text-slate-100"},us={class:"flex justify-end gap-2 border-t px-4 py-3"},rs=W({__name:"ReceiptModal",props:{items:{},subtotal:{},productDiscountTotal:{},invoiceDiscountMode:{},invoiceDiscountValue:{},invoiceDiscountAmount:{},grandTotal:{}},emits:["confirm","cancel"],setup(C,{emit:M}){const k=C,D=M;return(w,b)=>(p(),x("div",Ut,[e("div",Bt,[e("div",Ht,[b[3]||(b[3]=e("h3",{class:"text-base font-semibold text-slate-100"},"Receipt",-1)),e("button",{class:"text-slate-400 hover:text-slate-200",onClick:b[0]||(b[0]=v=>D("cancel"))},"✕")]),e("div",Jt,[e("div",Kt,"Date/Time: "+c(new Date().toLocaleString()),1),e("ul",Gt,[(p(!0),x(U,null,J(k.items,v=>(p(),x("li",{key:v.id,class:"py-2 text-sm"},[e("div",Qt,[e("span",Yt,c(v.name)+" × "+c(v.quantity),1),e("span",Wt,"Rs "+c(v.lineTotal.toFixed(2)),1)]),e("div",Xt,[e("span",null,"Gross: Rs "+c(v.gross.toFixed(2)),1),e("span",null,"Discount: Rs "+c(v.lineDiscount.toFixed(2)),1)])]))),128))]),e("div",Zt,[e("div",es,[b[4]||(b[4]=e("span",{class:"text-slate-300"},"Subtotal",-1)),e("span",ts,"Rs "+c(C.subtotal.toFixed(2)),1)]),e("div",ss,[b[5]||(b[5]=e("span",{class:"text-slate-300"},"Product Discounts",-1)),e("span",os,"Rs "+c(C.productDiscountTotal.toFixed(2)),1)]),e("div",ns,[e("span",ls," Invoice Discount ("+c(C.invoiceDiscountMode==="percent"?`${C.invoiceDiscountValue}%`:`Rs ${C.invoiceDiscountValue}`)+") ",1),e("span",is,"Rs "+c(C.invoiceDiscountAmount.toFixed(2)),1)])]),e("div",as,[b[6]||(b[6]=e("span",{class:"text-sm font-medium text-slate-200"},"Grand Total",-1)),e("span",ds,"Rs "+c(C.grandTotal.toFixed(2)),1)])]),e("div",us,[e("button",{class:"rounded-md border border-[rgba(255,255,255,0.06)] px-4 py-2 text-sm text-slate-200 hover:dark-panel",onClick:b[1]||(b[1]=v=>D("cancel"))},"Cancel"),e("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700",onClick:b[2]||(b[2]=v=>D("confirm"))},"Confirm")])])]))}}),cs={class:"space-y-2"},vs={class:"flex gap-2 items-center"},ms=["title"],ps={class:"text-sm"},fs={key:0,class:"fixed inset-0 z-40 flex items-center justify-center"},xs={class:"relative z-50 w-[340px] rounded-lg dark-panel p-4"},gs={class:"mb-3 flex items-center justify-between"},bs={class:"mb-2 rounded-md border border-transparent dark-panel px-3 py-2 text-right text-2xl font-mono text-slate-100"},ks={class:"grid grid-cols-4 gap-2"},ys=W({__name:"PaymentSelect",props:{modelValue:{required:!0},modelModifiers:{}},emits:ze(["apply-amount","open-resume","toggle-scan"],["update:modelValue"]),setup(C,{emit:M}){const k=Le(C,"modelValue"),D=M,w=S(!1),b=S(!1),v=S("0");function d(y){v.value==="0"?v.value=y:v.value+=y}function g(){v.value.includes(".")||(v.value+=".")}function _(){v.value="0"}function n(){v.value.length<=1?v.value="0":v.value=v.value.slice(0,-1)}function u(y){const o=v.value.slice(-1);"+-*/".includes(o)?v.value=v.value.slice(0,-1)+y:v.value+=y}function $(){try{const o=v.value.replace(/[^0-9+\-*/().% ]/g,"").replace(/(\d+\.?\d*)%/g,"($1/100)"),a=Function(`return (${o})`)();Number.isFinite(a)&&(v.value=String(Number(a.toFixed(2))))}catch{}}function K(y){if(!w.value)return;const o=y.key;if(/^[0-9]$/.test(o)){y.preventDefault(),d(o);return}if(o==="."){y.preventDefault(),g();return}if(o==="Enter"||o==="="){y.preventDefault(),$();return}if(o==="Backspace"){y.preventDefault(),n();return}if(o==="Escape"){y.preventDefault(),w.value=!1;return}if(o==="+"||o==="-"||o==="*"||o==="/"){y.preventDefault(),u(o);return}if(o==="%"){y.preventDefault(),u("%");return}if(o.toLowerCase()==="c"){y.preventDefault(),_();return}}H(w,y=>{y?window.addEventListener("keydown",K):window.removeEventListener("keydown",K)});function O(){b.value=!b.value,D("toggle-scan",b.value)}return(y,o)=>(p(),x("div",cs,[o[26]||(o[26]=e("div",{class:"payment-label text-sm font-medium"},"Payment Type",-1)),e("div",vs,[e("button",{class:E([k.value==="cash"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:o[0]||(o[0]=a=>k.value="cash")},"Cash",2),e("button",{class:E([k.value==="card"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:o[1]||(o[1]=a=>k.value="card")},"Card",2),e("button",{class:E([k.value==="mobile"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:o[2]||(o[2]=a=>k.value="mobile")},"Mobile",2),e("button",{onClick:o[3]||(o[3]=a=>w.value=!0),class:"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md",title:"Open calculator"},[...o[22]||(o[22]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h8M8 11h8M8 15h8M5 5h14v14H5z"})],-1),Ce(" Calc ",-1)])]),e("button",{onClick:o[4]||(o[4]=a=>D("open-resume")),class:"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md",title:"Resume suspended sale"},[...o[23]||(o[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h4v4H3zM7 6h4v4H7zM11 10h4v4h-4zM15 6h4v4h-4zM3 14h4v4H3zM7 18h4v-4H7z"})],-1),Ce(" Resume Sale ",-1)])]),e("button",{onClick:O,class:E(b.value?"ml-2 inline-flex items-center gap-2 rounded-md border border-green-600 bg-green-600/20 px-3 py-1 text-sm text-green-400 shadow-sm":"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md"),title:b.value?"Disable Scan Mode":"Enable Scan Mode"},[o[24]||(o[24]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7h18M3 12h18M3 17h18"})],-1)),e("span",ps,c(b.value?"Scan: ON":"Scan: OFF"),1)],10,ms)]),w.value?(p(),x("div",fs,[e("div",{class:"absolute inset-0 bg-black/40",onClick:o[5]||(o[5]=a=>w.value=!1)}),e("div",xs,[e("div",gs,[o[25]||(o[25]=e("div",{class:"text-lg font-semibold text-slate-100"},"Calculator",-1)),e("button",{class:"text-sm text-slate-300",onClick:o[6]||(o[6]=a=>w.value=!1)},"Close")]),e("div",bs,c(v.value),1),e("div",ks,[e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:_},"C"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:n},"⌫"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[7]||(o[7]=a=>u("%"))},"%"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[8]||(o[8]=a=>u("/"))},"÷"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[9]||(o[9]=a=>d("7"))},"7"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[10]||(o[10]=a=>d("8"))},"8"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[11]||(o[11]=a=>d("9"))},"9"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[12]||(o[12]=a=>u("*"))},"×"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[13]||(o[13]=a=>d("4"))},"4"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[14]||(o[14]=a=>d("5"))},"5"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[15]||(o[15]=a=>d("6"))},"6"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[16]||(o[16]=a=>u("-"))},"−"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[17]||(o[17]=a=>d("1"))},"1"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[18]||(o[18]=a=>d("2"))},"2"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[19]||(o[19]=a=>d("3"))},"3"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[20]||(o[20]=a=>u("+"))},"+"),e("button",{class:"col-span-2 rounded dark-panel p-3 text-sm text-center text-slate-200",onClick:o[21]||(o[21]=a=>d("0"))},"0"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:g},"."),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:$},"=")]),e("div",{class:"mt-3 flex gap-2"},[e("button",{class:"flex-1 rounded dark-panel px-3 py-2 text-sm text-slate-200",onClick:_},"Clear")])])])):A("",!0)]))}});const hs=ot(ys,[["__scopeId","data-v-b4c25232"]]),Ds={class:"grid grid-cols-1 gap-6 lg:grid-cols-3"},ws={class:"lg:col-span-2"},Cs={class:"mb-3"},$s={key:0,class:"mt-2 rounded-md border border-yellow-200 bg-yellow-50 px-3 py-2 text-sm text-yellow-800"},Ss={class:"pr-2",style:{height:"680px",overflow:"hidden"}},_s={class:"hidden lg:block lg:col-span-1"},Ms={class:"mt-4 space-y-3"},Ts={class:"rounded-lg border dark-panel p-3 shadow-sm"},Is=["value"],Vs={key:0,class:"mt-2 text-xs text-slate-400"},Ns={class:"rounded-lg border dark-panel p-3 shadow-sm"},Fs={key:0,class:"mt-2 flex items-center gap-2"},As={key:1,class:"mt-2 text-sm text-white bg-green-700 rounded px-2 py-1"},qs={key:0,class:"rounded-lg border dark-panel p-3 shadow-sm"},Rs={class:"mb-2 flex items-center gap-2"},js={key:0,class:"mt-2"},Es=["max"],Os={class:"mt-1 text-xs text-slate-400"},Ps={class:"text-red-400"},zs=["aria-expanded"],Ls={class:"fixed inset-0 z-50 lg:hidden"},Us={id:"mobile-cart",role:"dialog","aria-modal":"true",class:"absolute left-0 right-0 bottom-0 z-50"},Bs={class:"flex items-center justify-between mb-3"},Hs={class:"max-h-[60vh] overflow-auto"},Js={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},Ks={class:"relative z-60 w-11/12 max-w-2xl rounded bg-white p-4 shadow-lg"},Gs={class:"flex items-center justify-between mb-3"},Qs={class:"mb-3"},Ys={key:0,class:"text-sm text-gray-500"},Ws={key:1,class:"space-y-2 max-h-96 overflow-auto"},Xs={class:"flex items-start gap-3"},Zs={class:"flex-1"},eo={class:"text-sm font-medium"},to={class:"text-xs text-gray-500"},so={class:"mt-2 text-xs"},oo={class:"flex flex-col gap-2"},no=["onClick"],lo=["onClick"],io=["onKeydown"],Me="posCart",pe="posSelectedCartItemId",ao="suspended_sales_",fo=W({__name:"PosView",setup(C){const M=Ue(),k=Be(),D=He(),w=Je(),b=Ke();function v(){b.push("/closing")}const d=$e([]),g=S(null),_=S("cash"),n=S(null),u=S(!1),$=S(0),K=S("Cashier-1"),O=S(!1),y=S(!1),o=S(null),a=$e({mode:"flat",value:0}),B=N(()=>d.map(s=>{const t=s.price*s.quantity,i=Math.max(s.discountValue,0),r=s.discountMode==="percent"?t*Math.min(i,100)/100:i,T=Math.min(r,t),l=t-T;return{...s,gross:t,lineDiscount:T,lineTotal:l}})),q=N(()=>B.value.reduce((s,t)=>s+t.lineTotal,0)),X=N(()=>B.value.reduce((s,t)=>s+t.lineDiscount,0)),P=N(()=>{const s=q.value;if(s<=0)return 0;if(a.mode==="percent"){const t=Math.min(Math.max(a.value,0),100);return s*t/100}return Math.min(Math.max(a.value,0),s)}),F=N(()=>Math.max(q.value-P.value,0)),Te=N(()=>X.value+P.value),fe=N(()=>u.value?Math.max(0,F.value-$.value):0),Z=N(()=>D.customersForCurrentStore),ee=N(()=>!!w.activeShift),I=S([]),G=S(!1),te=S(!1),ae=S(!1),se=S(""),j=S(null),Ie=Ge(),de=S(""),Ve=N(()=>{const s=de.value.trim().toLowerCase();return s?I.value.filter(t=>(t.customerName||"").toLowerCase().includes(s)?!0:t.items.some(i=>i.name.toLowerCase().includes(s))):I.value});function xe(){const s=Ie.currentStoreId||"";return`${ao}${s}`}function ue(){try{localStorage.setItem(xe(),JSON.stringify(I.value))}catch{}}function ge(){try{const s=localStorage.getItem(xe());if(!s){I.value=[];return}I.value=JSON.parse(s)}catch{I.value=[]}}function re(s){if(!w.activeShift){alert("Start a shift before adding items to the cart.");return}if(s.stock<1)return;const t=d.find(i=>i.id===s.id);if(t){t.quantity<s.stock&&(t.quantity+=1);return}d.push({id:s.id,name:s.name,price:s.price,quantity:1,stock:s.stock,image:s.image,discountMode:"flat",discountValue:0})}function Ne(){d.splice(0,d.length),g.value=null,n.value=null,u.value=!1,$.value=0,a.mode="flat",a.value=0}function ce(){var i;if(!d.length)return;const t={id:`hold_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,createdAt:new Date().toISOString(),items:d.map(r=>({...r})),subtotal:q.value,productDiscountTotal:X.value,invoiceDiscountMode:a.mode,invoiceDiscountValue:a.value,invoiceDiscountAmount:P.value,total:F.value,paymentType:_.value,cashier:K.value,customerId:n.value,customerName:n.value?(i=D.customersForCurrentStore.find(r=>r.id===n.value))==null?void 0:i.fullName:void 0};I.value.push(t),ue(),Ne()}function Fe(s){const t=I.value.findIndex(r=>r.id===s);if(t===-1)return;const i=I.value[t];d.splice(0,d.length,...i.items.map(r=>({...r}))),a.mode=i.invoiceDiscountMode,a.value=i.invoiceDiscountValue,_.value=i.paymentType,n.value=i.customerId||null,I.value.splice(t,1),ue(),G.value=!1}function Ae(s){const t=(s||"").trim();if(!t)return;const i=M.byBarcode,r=i.get(t);if(r){re(r);return}const T=t.replace(/^0+/,"");T&&i.get(T)&&re(i.get(T))}function qe(){const s=se.value.trim();s&&Ae(s),se.value="",te.value&&j.value&&setTimeout(()=>j.value&&j.value.focus(),20)}function Re(s){te.value=!!s}function je(s){const t=I.value.findIndex(i=>i.id===s);t!==-1&&(I.value.splice(t,1),ue())}function be(s,t){const i=d.find(f=>f.id===s);if(!i)return;const r=M.products.find(f=>f.id===s),T=r?r.stock:i.stock,l=Math.max(1,Math.min(t,T));i.quantity=l}function ve(s){const t=d.findIndex(i=>i.id===s);t!==-1&&(d.splice(t,1),g.value===s&&(g.value=null))}function ke(s){const t=d.find(i=>i.id===s.id);if(t&&(s.mode&&(t.discountMode=s.mode,t.discountMode==="percent"&&t.discountValue>100&&(t.discountValue=100)),s.value!==void 0)){let i=Math.max(s.value,0);t.discountMode==="percent"&&i>100&&(i=100),t.discountValue=i}}function ye(s){a.mode=s,s==="percent"&&a.value>100&&(a.value=100),s==="flat"&&a.value>q.value&&(a.value=q.value)}function he(s){let t=Math.max(s,0);a.mode==="percent"&&t>100&&(t=100),a.value=t}function oe(){if(d.length){if(!w.activeShift){alert("Please start a shift before processing sales.");return}if(F.value<=0){alert("Grand total must be greater than zero.");return}O.value=!0}}function Ee(){const s=n.value?D.customersForCurrentStore.find(r=>r.id===n.value):null,t=fe.value,i=k.recordSale({datetime:new Date().toISOString(),items:B.value.map(r=>({id:r.id,name:r.name,quantity:r.quantity,unitPrice:r.price,discountMode:r.discountMode,discountValue:r.discountValue,lineDiscount:r.lineDiscount,lineTotal:r.lineTotal})),subtotal:q.value,productDiscountTotal:X.value,invoiceDiscountMode:a.mode,invoiceDiscountValue:a.value,invoiceDiscountAmount:P.value,totalDiscount:Te.value,total:F.value,paymentType:_.value,cashier:K.value,customerId:n.value||void 0,customerName:(s==null?void 0:s.fullName)||void 0,dueAmount:t>0?t:void 0});M.decrementStock(d.map(r=>({id:r.id,quantity:r.quantity}))),d.splice(0,d.length),g.value=null,n.value=null,u.value=!1,$.value=0,a.mode="flat",a.value=0,O.value=!1,o.value={invoiceNumber:i.invoiceNumber,datetime:i.datetime,items:i.items.map(r=>({name:r.name,quantity:r.quantity,unitPrice:r.unitPrice,lineDiscount:r.lineDiscount,lineTotal:r.lineTotal})),subtotal:i.subtotal,productDiscountTotal:i.productDiscountTotal,invoiceDiscountMode:i.invoiceDiscountMode,invoiceDiscountValue:i.invoiceDiscountValue,invoiceDiscountAmount:i.invoiceDiscountAmount,total:i.total,paymentType:i.paymentType,cashier:i.cashier,customerName:i.customerName},localStorage.setItem("lastInvoice",JSON.stringify(o.value)),y.value=!0}function Oe(){O.value=!1}function De(s){g.value=s}function we(s){if(s.key==="F1"){s.preventDefault(),oe();return}if(s.key==="F2"){s.preventDefault(),ce();return}s.key==="Enter"&&!O.value&&d.length?(s.preventDefault(),oe()):s.key==="Delete"&&g.value!=null&&(s.preventDefault(),ve(g.value))}H(u,s=>{s?$.value=F.value:$.value=0}),H(te,s=>{s?(ae.value=!0,setTimeout(()=>{j.value&&j.value.focus()},50),setTimeout(()=>ae.value=!1,1600)):j.value&&j.value.blur()}),H(F,s=>{u.value&&$.value>s&&($.value=s)}),H(d,s=>{localStorage.setItem(Me,JSON.stringify(s))},{deep:!0}),H(g,s=>{s==null?localStorage.removeItem(pe):localStorage.setItem(pe,String(s))}),Qe(()=>{M.load(),k.load(),D.load(),w.setCurrentStore();const s=localStorage.getItem(Me);if(s)try{const l=JSON.parse(s);Array.isArray(l)&&d.splice(0,d.length,...l.map(f=>{const V=M.products.find(h=>h.id===f.id),m=V?V.stock:f.stock;return{id:f.id,name:f.name,price:f.price,quantity:Math.max(1,Math.min(f.quantity??1,m??1)),stock:m,image:f.image,discountMode:f.discountMode||"flat",discountValue:f.discountValue??0}}))}catch{}const t=localStorage.getItem(pe);if(t){const l=Number(t);g.value=Number.isFinite(l)?l:null}const i=localStorage.getItem("lastInvoice");if(i)try{o.value=JSON.parse(i)}catch{o.value=null}const r=localStorage.getItem("refundToCart");if(r)try{JSON.parse(r).forEach(({productId:f,quantity:V})=>{const m=M.products.find(h=>h.id===f);if(m){const h=d.find(z=>z.id===f);h?h.quantity=Math.min(h.quantity+V,m.stock):d.push({id:m.id,name:m.name,price:m.price,quantity:Math.min(V,m.stock),stock:m.stock,image:m.image,discountMode:"flat",discountValue:0})}}),localStorage.removeItem("refundToCart")}catch{}const T=localStorage.getItem("exchangeToCart");if(T)try{const l=JSON.parse(T);l.return.forEach(({productId:f,quantity:V})=>{const m=M.products.find(h=>h.id===f);if(m){const h=d.find(z=>z.id===f);h?h.quantity=Math.min(h.quantity+V,m.stock):d.push({id:m.id,name:m.name,price:m.price,quantity:Math.min(V,m.stock),stock:m.stock,image:m.image,discountMode:"flat",discountValue:0})}}),l.exchange.forEach(({productId:f,quantity:V})=>{if(V<0){const m=d.find(h=>h.id===f);if(m&&(m.quantity=Math.max(0,m.quantity+V),m.quantity===0)){const h=d.findIndex(z=>z.id===f);h!==-1&&d.splice(h,1)}}else{const m=M.products.find(h=>h.id===f);if(m){const h=d.find(z=>z.id===f);h?h.quantity=Math.min(h.quantity+V,m.stock):d.push({id:m.id,name:m.name,price:m.price,quantity:Math.min(V,m.stock),stock:m.stock,image:m.image,discountMode:"flat",discountValue:0})}}}),localStorage.removeItem("exchangeToCart")}catch{}window.addEventListener("keydown",we),ge()});const{cartOpen:ne,toggleCart:Pe,closeCart:Q}=Ye();return Se(()=>{ne.value&&Q()}),Se(()=>{window.removeEventListener("keydown",we)}),(s,t)=>{var i,r,T;return p(),x(U,null,[e("div",Ds,[e("section",ws,[e("div",Cs,[ee.value?A("",!0):(p(),x("div",$s,[e("div",{class:"flex items-center gap-2"},[t[14]||(t[14]=e("div",null,[e("strong",null,"Start a shift first:"),e("span",{class:"ml-1"},"Please start the shift before adding items to the cart.")],-1)),e("button",{type:"button",onClick:v,class:"ml-auto rounded px-2 py-1 text-sm font-semibold text-yellow-900 underline hover:no-underline"}," Go to Closing ")])]))]),e("div",Ss,[le(mt,{class:"h-full",products:R(M).products,disabled:!ee.value,onAdd:re},null,8,["products","disabled"])])]),e("aside",_s,[le(_e,{items:B.value,subtotal:q.value,invoiceDiscountMode:a.mode,invoiceDiscountValue:a.value,invoiceDiscountAmount:P.value,grandTotal:F.value,selectedId:g.value,disabled:!ee.value,onSelect:De,onUpdateQty:be,onRemove:ve,onCheckout:oe,onHold:ce,onUpdateItemDiscount:ke,onUpdateInvoiceDiscountMode:ye,onUpdateInvoiceDiscountValue:he},null,8,["items","subtotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal","selectedId","disabled"]),e("div",Ms,[e("div",Ts,[t[16]||(t[16]=e("label",{class:"mb-2 block text-sm font-medium text-slate-300"},"Customer (Optional)",-1)),L(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),class:"w-full rounded-md border dark-panel px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:text-slate-100"},[t[15]||(t[15]=e("option",{value:null},"Walk-in Customer",-1)),(p(!0),x(U,null,J(Z.value,l=>(p(),x("option",{key:l.id,value:l.id},c(l.fullName)+" ("+c(l.phone)+") ",9,Is))),128))],512),[[We,n.value]]),n.value?(p(),x("div",Vs,[e("div",null,"Total Purchases: ₹"+c(((i=Z.value.find(l=>l.id===n.value))==null?void 0:i.totalPurchases.toFixed(2))||"0.00"),1),e("div",{class:E((r=Z.value.find(l=>l.id===n.value))!=null&&r.totalDue?"text-red-400":"text-green-400")}," Current Due: ₹"+c(((T=Z.value.find(l=>l.id===n.value))==null?void 0:T.totalDue.toFixed(2))||"0.00"),3)])):A("",!0)]),e("div",Ns,[le(hs,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=l=>_.value=l),onApplyAmount:t[2]||(t[2]=l=>{$.value=l,u.value=!0}),onOpenResume:t[3]||(t[3]=()=>{ge(),G.value=!0}),onToggleScan:Re},null,8,["modelValue"]),te.value?(p(),x("div",Fs,[...t[17]||(t[17]=[e("div",{class:"rounded bg-green-900 px-2 py-1 text-sm font-medium text-green-300"},"Scan Mode: ON",-1)])])):A("",!0),ae.value?(p(),x("div",As,"Scan Mode Activated")):A("",!0)]),n.value?(p(),x("div",qs,[e("div",Rs,[L(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>u.value=l),type:"checkbox",id:"creditSale",class:"h-4 w-4 rounded border-slate-700 text-indigo-400 focus:ring-indigo-500"},null,512),[[Xe,u.value]]),t[18]||(t[18]=e("label",{for:"creditSale",class:"text-sm font-medium text-slate-300"},"Credit Sale",-1))]),u.value?(p(),x("div",js,[t[19]||(t[19]=e("label",{class:"block text-sm text-slate-300"},"Amount Paid",-1)),L(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>$.value=l),type:"number",min:"0",max:F.value,step:"0.01",class:"mt-1 w-full rounded-md border dark-panel px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:text-slate-100"},null,8,Es),[[ie,$.value,void 0,{number:!0}]]),e("div",Os,[e("div",null,"Grand Total: ₹"+c(F.value.toFixed(2)),1),e("div",Ps,"Due: ₹"+c(fe.value.toFixed(2)),1)])])):A("",!0)])):A("",!0)])])]),e("button",{class:"fixed z-40 bottom-20 right-4 inline-flex items-center justify-center rounded-full bg-green-600 text-white p-4 shadow-lg lg:hidden",onClick:t[6]||(t[6]=l=>R(Pe)()),"aria-controls":"mobile-cart","aria-expanded":R(ne),title:"Toggle cart"},[...t[20]||(t[20]=[e("span",{class:"sr-only"},"Open cart",-1),e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor","stroke-width":"1.6",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h2l.4 2M7 13h10l4-8H5.4"})],-1),e("span",{class:"ml-2 hidden sm:inline"},"Cart",-1)])],8,zs),(p(),me(et,{to:"body"},[L(e("div",Ls,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[7]||(t[7]=(...l)=>R(Q)&&R(Q)(...l)),"aria-hidden":"true"}),e("div",Us,[e("div",{class:E(["transform transition-transform duration-300 bg-white dark:bg-slate-900 rounded-t-lg p-4",R(ne)?"translate-y-0":"translate-y-full"])},[e("div",Bs,[t[21]||(t[21]=e("div",{class:"text-lg font-semibold"},"Cart",-1)),e("button",{onClick:t[8]||(t[8]=(...l)=>R(Q)&&R(Q)(...l)),class:"p-2"},"Close")]),e("div",Hs,[le(_e,{items:B.value,subtotal:q.value,invoiceDiscountMode:a.mode,invoiceDiscountValue:a.value,invoiceDiscountAmount:P.value,grandTotal:F.value,selectedId:g.value,disabled:!ee.value,onSelect:De,onUpdateQty:be,onRemove:ve,onCheckout:oe,onHold:ce,onUpdateItemDiscount:ke,onUpdateInvoiceDiscountMode:ye,onUpdateInvoiceDiscountValue:he},null,8,["items","subtotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal","selectedId","disabled"])])],2)])],512),[[Ze,R(ne)]])])),O.value?(p(),me(rs,{key:0,items:B.value,subtotal:q.value,productDiscountTotal:X.value,invoiceDiscountMode:a.mode,invoiceDiscountValue:a.value,invoiceDiscountAmount:P.value,grandTotal:F.value,onConfirm:Ee,onCancel:Oe},null,8,["items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal"])):A("",!0),y.value&&o.value?(p(),me(st,{key:1,invoiceNumber:o.value.invoiceNumber,datetime:o.value.datetime,items:o.value.items,subtotal:o.value.subtotal,productDiscountTotal:o.value.productDiscountTotal,invoiceDiscountMode:o.value.invoiceDiscountMode,invoiceDiscountValue:o.value.invoiceDiscountValue,invoiceDiscountAmount:o.value.invoiceDiscountAmount,total:o.value.total,paymentType:o.value.paymentType,cashier:o.value.cashier,customerName:o.value.customerName,onClose:t[9]||(t[9]=l=>y.value=!1)},null,8,["invoiceNumber","datetime","items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","total","paymentType","cashier","customerName"])):A("",!0),G.value?(p(),x("div",Js,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[10]||(t[10]=l=>G.value=!1)}),e("div",Ks,[e("div",Gs,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold"},"Suspended Sales",-1)),e("button",{class:"text-sm text-gray-600",onClick:t[11]||(t[11]=l=>G.value=!1)},"Close")]),e("div",Qs,[L(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>de.value=l),type:"text",placeholder:"Search suspended sales or items...",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"},null,512),[[ie,de.value]])]),I.value.length?(p(),x("ul",Ws,[(p(!0),x(U,null,J(Ve.value,l=>(p(),x("li",{key:l.id,class:"rounded border p-3"},[e("div",Xs,[e("div",Zs,[e("div",eo,c(l.customerName||"Walk-in")+" — "+c(l.total.toFixed(2))+" Rs",1),e("div",to,c(new Date(l.createdAt).toLocaleString()),1),e("div",so,[(p(!0),x(U,null,J(l.items,f=>(p(),x("div",{key:l.id+"_"+f.id},c(f.name)+" × "+c(f.quantity)+" — Rs "+c((f.price*f.quantity).toFixed(2)),1))),128))])]),e("div",oo,[e("button",{onClick:f=>Fe(l.id),class:"rounded bg-green-600 px-3 py-1 text-white text-sm"},"Resume",8,no),e("button",{onClick:f=>je(l.id),class:"rounded border px-3 py-1 text-sm"},"Delete",8,lo)])])]))),128))])):(p(),x("div",Ys,"No suspended sales."))])])):A("",!0),L(e("input",{ref_key:"scanInput",ref:j,"onUpdate:modelValue":t[13]||(t[13]=l=>se.value=l),onKeydown:tt(Y(qe,["prevent"]),["enter"]),"aria-hidden":"true",autocomplete:"off",tabindex:"-1",type:"text",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",opacity:"0"}},null,40,io),[[ie,se.value]])],64)}}});export{fo as default};
