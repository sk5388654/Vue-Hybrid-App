import{e as w,a as I}from"./print-7202dff5.js";import{d as D,x as T,k as P,y as S,c as l,o as r,a as o,b as e,t as d,f as u,F as h,e as v,i as N}from"./index-584bf46f.js";const _={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},q={class:"w-full max-w-3xl rounded-lg dark-panel"},F={class:"flex items-center justify-between border-b border-transparent px-6 py-4"},C={class:"text-xs text-slate-400"},M={class:"px-6 py-4 text-sm text-slate-200"},$={class:"grid gap-3 sm:grid-cols-2"},j={class:"font-semibold text-slate-100"},V={class:"font-semibold text-slate-100"},A={key:0},B={class:"mt-6 overflow-hidden rounded-lg border border-transparent"},U={class:"min-w-full text-sm"},L={class:"divide-y divide-gray-100"},Q={class:"px-4 py-2 text-slate-100"},z={class:"px-4 py-2 text-right"},E={class:"px-4 py-2 text-right"},K={class:"px-4 py-2 text-right font-medium"},O={key:0,class:"mt-6 overflow-hidden rounded-lg border border-transparent"},G={class:"min-w-full text-sm"},H={class:"divide-y divide-gray-100"},J={class:"px-4 py-2 text-slate-100"},W={class:"px-4 py-2 text-right"},X={class:"px-4 py-2 text-right"},Y={class:"px-4 py-2 text-right font-medium"},Z={class:"mt-6 rounded-lg border border-transparent dark-panel px-4 py-3 text-sm text-slate-200"},ee={class:"flex items-center justify-between"},te={class:"text-lg font-semibold text-slate-100"},ne={key:0,class:"mt-2 text-sm text-slate-300"},se={class:"mt-2 text-xs text-slate-400"},de={key:1,class:"mt-2 text-xs text-slate-400"},ie={class:"font-medium text-slate-200"},oe=D({__name:"RefundReceiptModal",props:{refund:{},sale:{},existingRefunds:{}},emits:["close"],setup(i,{emit:y}){const s=i,b=y,c=T(),f=P();S(()=>{c.stores.length||c.load(),f.sales.length||f.load()});const x=l(()=>{const a=c.stores.find(t=>t.id===s.refund.storeId);return(a==null?void 0:a.name)??"Store POS"}),p=l(()=>s.existingRefunds.filter(a=>a.refundId!==s.refund.refundId)),R=l(()=>s.existingRefunds.reduce((a,t)=>a+t.totalRefund,0)),m=l(()=>!s.refund.exchangeDifference||s.refund.exchangeDifference===0?null:s.refund.exchangeDifference>0?`Balance refunded to customer: ₹${s.refund.exchangeDifference.toFixed(2)}`:`Customer paid difference: ₹${Math.abs(s.refund.exchangeDifference).toFixed(2)}`),g=l(()=>s.refund.exchangeSaleId?f.sales.find(a=>a.id===s.refund.exchangeSaleId)??null:null);function k(){var a;if(s.refund.refundType==="exchange"&&g.value){const t=g.value;w({shopName:x.value,invoiceNumber:t.invoiceNumber,datetime:t.datetime,items:t.items.map(n=>({name:n.name,quantity:n.quantity,unitPrice:n.unitPrice,lineDiscount:n.lineDiscount,lineTotal:n.lineTotal})),subtotal:t.subtotal,productDiscountTotal:t.productDiscountTotal,invoiceDiscountMode:t.invoiceDiscountMode,invoiceDiscountValue:t.invoiceDiscountValue,invoiceDiscountAmount:t.invoiceDiscountAmount,total:t.total,paymentType:t.paymentType,cashier:t.cashier,customerName:t.customerName});return}I({storeName:x.value,refundId:s.refund.refundId,invoiceNumber:s.refund.invoiceNumber,refundType:s.refund.refundType.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),refundMethod:s.refund.refundMethod,refundReason:s.refund.refundReason,cashier:s.refund.cashier,refundDate:s.refund.createdAt,refundedItems:s.refund.refundedItems.map(t=>({name:t.name,quantity:t.quantity,unitPrice:t.unitPrice,lineTotal:t.lineTotal})),exchangedItems:(a=s.refund.exchangedItems)==null?void 0:a.map(t=>({name:t.name,quantity:t.quantity,unitPrice:t.unitPrice,lineTotal:t.lineTotal})),totalRefund:s.refund.totalRefund,exchangeDifference:s.refund.exchangeDifference})}return(a,t)=>(r(),o("div",_,[e("div",q,[e("div",F,[e("div",null,[t[1]||(t[1]=e("h2",{class:"text-lg font-semibold text-slate-100"},"Refund Receipt",-1)),e("p",C,"Refund "+d(i.refund.refundId)+" • Invoice #"+d(i.refund.invoiceNumber),1)]),e("button",{class:"rounded-md border border-transparent px-3 py-1 text-xs text-slate-300 hover:dark-panel",type:"button",onClick:t[0]||(t[0]=n=>b("close"))}," Close ")]),e("div",M,[e("div",$,[e("div",null,[t[2]||(t[2]=e("div",{class:"text-xs uppercase tracking-wide text-slate-400"},"Store",-1)),e("div",j,d(x.value),1)]),e("div",null,[t[3]||(t[3]=e("div",{class:"text-xs uppercase tracking-wide text-slate-400"},"Refund Date",-1)),e("div",null,d(new Date(i.refund.createdAt).toLocaleString()),1)]),e("div",null,[t[4]||(t[4]=e("div",{class:"text-xs uppercase tracking-wide text-slate-400"},"Cashier",-1)),e("div",null,d(i.refund.cashier),1)]),e("div",null,[t[5]||(t[5]=e("div",{class:"text-xs uppercase tracking-wide text-slate-400"},"Refund Type",-1)),e("div",V,d(i.refund.refundType.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())),1)]),e("div",null,[t[6]||(t[6]=e("div",{class:"text-xs uppercase tracking-wide text-slate-400"},"Method",-1)),e("div",null,d(i.refund.refundMethod),1)]),i.refund.refundReason?(r(),o("div",A,[t[7]||(t[7]=e("div",{class:"text-xs uppercase tracking-wide text-slate-400"},"Reason",-1)),e("div",null,d(i.refund.refundReason),1)])):u("",!0)]),e("div",B,[t[9]||(t[9]=e("div",{class:"dark-panel px-4 py-2 text-xs font-semibold uppercase tracking-wide text-slate-300"}," Refunded Items ",-1)),e("table",U,[t[8]||(t[8]=e("thead",{class:"bg-white text-slate-400"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left font-medium"},"Item"),e("th",{class:"px-4 py-2 text-right font-medium"},"Qty"),e("th",{class:"px-4 py-2 text-right font-medium"},"Unit Price"),e("th",{class:"px-4 py-2 text-right font-medium"},"Subtotal")])],-1)),e("tbody",L,[(r(!0),o(h,null,v(i.refund.refundedItems,n=>(r(),o("tr",{key:`${n.id}-${n.quantity}`},[e("td",Q,d(n.name),1),e("td",z,d(n.quantity),1),e("td",E,"₹"+d(n.unitPrice.toFixed(2)),1),e("td",K,"₹"+d(n.lineTotal.toFixed(2)),1)]))),128))])])]),i.refund.exchangedItems&&i.refund.exchangedItems.length?(r(),o("div",O,[t[11]||(t[11]=e("div",{class:"bg-blue-50 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-blue-700"}," Replacement Items ",-1)),e("table",G,[t[10]||(t[10]=e("thead",{class:"bg-white text-slate-400"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left font-medium"},"Item"),e("th",{class:"px-4 py-2 text-right font-medium"},"Qty"),e("th",{class:"px-4 py-2 text-right font-medium"},"Unit Price"),e("th",{class:"px-4 py-2 text-right font-medium"},"Subtotal")])],-1)),e("tbody",H,[(r(!0),o(h,null,v(i.refund.exchangedItems,n=>(r(),o("tr",{key:`${n.id}-${n.quantity}`},[e("td",J,d(n.name),1),e("td",W,d(n.quantity),1),e("td",X,"₹"+d(n.unitPrice.toFixed(2)),1),e("td",Y,"₹"+d(n.lineTotal.toFixed(2)),1)]))),128))])])])):u("",!0),e("div",Z,[e("div",ee,[t[12]||(t[12]=e("span",{class:"font-semibold text-slate-100"},"Refund Total",-1)),e("span",te,"₹"+d(i.refund.totalRefund.toFixed(2)),1)]),m.value?(r(),o("div",ne,d(m.value),1)):u("",!0),e("div",se," Total refunded for this invoice so far: ₹"+d(R.value.toFixed(2)),1),p.value.length?(r(),o("div",de,[t[13]||(t[13]=N(" Previous refunds: ",-1)),e("span",ie,d(p.value.map(n=>n.refundId).join(", ")),1)])):u("",!0)])]),e("div",{class:"flex items-center justify-between border-t border-transparent dark-panel px-6 py-4"},[t[14]||(t[14]=e("p",{class:"text-xs text-slate-400"},"Keep this receipt for audit and closing voucher summaries.",-1)),e("button",{class:"rounded-md bg-orange-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-orange-700",type:"button",onClick:k}," Print Refund Receipt ")])])]))}});export{oe as _};
