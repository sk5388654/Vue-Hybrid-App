import{d as b,k as A,K as F,O as v,L,y as M,c as x,o as g,a as y,b as s,F as N,e as R,t as u}from"./index-c52e9aa3.js";const P={class:"space-y-4"},B={class:"rounded-lg border border-transparent p-4 dark-panel"},U={class:"w-full text-sm"},j={class:"divide-y divide-gray-100"},q={class:"px-3 py-2 text-slate-200"},H={class:"px-3 py-2 text-right font-medium text-slate-100"},I={class:"px-3 py-2 text-right text-slate-300"},K={class:"px-3 py-2 text-right text-slate-300"},O={class:"px-3 py-2 text-right text-slate-300"},V={class:"px-3 py-2 text-right text-slate-300"},J=b({__name:"EmployeeDashboard",setup(z){const h=A(),f=F(),d=v(),D=L(),C=new Date;M(()=>{h.load(),f.load(),d.load(),D.load()});const T=x(()=>{const o=new Set;return h.sales.forEach(t=>o.add(t.cashier||"Unknown")),f.refundsForCurrentStore.forEach(t=>o.add(t.cashier||"Unknown")),d.employeesForCurrentStore.forEach(t=>o.add(t.fullName)),Array.from(o).map(t=>({name:t}))}),k=x(()=>{const o=new Map;T.value.forEach(e=>{o.set(e.name,{salesTotal:0,grossSales:0,totalDiscount:0,refundsAmount:0,refundsCount:0,hours:0})}),h.sales.forEach(e=>{const n=o.get(e.cashier)||{salesTotal:0,grossSales:0,totalDiscount:0,refundsAmount:0,refundsCount:0,hours:0};n.salesTotal+=e.total;const r=e.items.reduce((m,i)=>m+i.unitPrice*i.quantity,0);n.grossSales+=r;const c=Math.max(0,r-e.total);n.totalDiscount+=c,o.set(e.cashier,n)}),f.refundsForCurrentStore.forEach(e=>{const n=e.cashier||"Unknown",r=o.get(n)||{salesTotal:0,grossSales:0,totalDiscount:0,refundsAmount:0,refundsCount:0,hours:0};r.refundsAmount+=e.totalRefund,r.refundsCount+=1,o.set(n,r)});const t=d.activityLogsForCurrentStore,a=new Map;return t.forEach(e=>{const n=a.get(e.employeeId)||[];n.push(e),a.set(e.employeeId,n)}),a.forEach((e,n)=>{e.sort((l,p)=>new Date(l.timestamp).getTime()-new Date(p.timestamp).getTime());let r=0,c=null;if(e.forEach(l=>{const p=(l.action||"").toLowerCase();if(p.includes("login"))c=l.timestamp;else if(p.includes("logout")&&c){const w=new Date(c).getTime(),S=new Date(l.timestamp).getTime();S>w&&(r+=S-w),c=null}}),c){const l=new Date(c).getTime();r+=Math.max(0,C.getTime()-l)}const m=d.employees.find(l=>l.id===n),i=m?m.fullName:n,_=o.get(i)||{salesTotal:0,grossSales:0,totalDiscount:0,refundsAmount:0,refundsCount:0,hours:0};_.hours=Number((r/(1e3*60*60)).toFixed(2)),o.set(i,_)}),o}),E=x(()=>{const o=[];return k.value.forEach((t,a)=>{const e=t.grossSales?t.totalDiscount/t.grossSales*100:0;o.push({cashier:a,salesTotal:t.salesTotal||0,avgDiscountPercent:Number(e.toFixed(2)),refundsAmount:t.refundsAmount||0,refundsCount:t.refundsCount||0,hours:t.hours||0})}),o.sort((t,a)=>a.salesTotal-t.salesTotal)});return(o,t)=>(g(),y("div",P,[t[1]||(t[1]=s("div",{class:"flex items-center justify-between"},[s("h2",{class:"text-lg font-semibold"},"Employee Performance Dashboard")],-1)),s("div",B,[s("table",U,[t[0]||(t[0]=s("thead",{class:"dark-panel text-slate-300"},[s("tr",null,[s("th",{class:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wide"},"Cashier"),s("th",{class:"px-3 py-2 text-right text-xs font-medium uppercase tracking-wide"},"Sales (Rs)"),s("th",{class:"px-3 py-2 text-right text-xs font-medium uppercase tracking-wide"},"Avg Discount (%)"),s("th",{class:"px-3 py-2 text-right text-xs font-medium uppercase tracking-wide"},"Refunds (Rs)"),s("th",{class:"px-3 py-2 text-right text-xs font-medium uppercase tracking-wide"},"Refund Count"),s("th",{class:"px-3 py-2 text-right text-xs font-medium uppercase tracking-wide"},"Hours Logged")])],-1)),s("tbody",j,[(g(!0),y(N,null,R(E.value,a=>(g(),y("tr",{key:a.cashier},[s("td",q,u(a.cashier),1),s("td",H,"₹"+u(a.salesTotal.toFixed(2)),1),s("td",I,u(a.avgDiscountPercent)+"%",1),s("td",K,"₹"+u(a.refundsAmount.toFixed(2)),1),s("td",O,u(a.refundsCount),1),s("td",V,u(a.hours)+"h",1)]))),128))])])])]))}});export{J as default};
