import{d as q,q as A,k as P,I as M,J as R,r,y as V,c as b,o as l,a as i,b as t,w as $,v as F,F as p,e as x,E as I,f as g,n as L,t as c,B}from"./index-bf582a4f.js";import{_ as E}from"./InvoiceModal.vue_vue_type_script_setup_true_lang-1573670e.js";import"./BarcodeDisplay.vue_vue_type_script_setup_true_lang-9e9de9e9.js";import"./_commonjsHelpers-725317a4.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./print-3a01aada.js";const j={class:"space-y-6"},z={class:"glass-panel space-y-4"},H={class:"flex flex-wrap items-center justify-between gap-3"},U={class:"flex flex-wrap gap-2"},J=["onClick"],O={key:0,class:"rounded-2xl border border-dashed border-slate-200 p-6 text-center text-sm text-slate-500"},Q={key:1,class:"overflow-hidden rounded-2xl border border-slate-100"},W={class:"max-h-[600px] overflow-auto"},G={class:"table-modern"},K={class:"font-semibold text-slate-900"},X={class:"text-sm text-slate-600"},Y={class:"pill-badge capitalize"},Z={class:"text-right font-semibold text-slate-900"},ee={class:"text-right"},te={key:0,class:"text-amber-600 font-semibold"},se={key:1,class:"text-slate-400"},ne={class:"text-center"},oe={class:"flex flex-wrap items-center justify-center gap-2"},ae=["onClick"],le=["onClick"],ie=["onClick"],he=q({__name:"SalesHistory",setup(ce){const k=A(),d=P(),h=M(),D=R(),w=["all","cash","card","mobile"],o=r(null),m=r(!1),v=r(""),u=r("all");V(()=>{d.load(),h.load()});const f=b(()=>{const n=new Map;return h.refundsForCurrentStore.forEach(s=>{n.set(s.saleId,(n.get(s.saleId)||0)+s.totalRefund)}),n}),_=b(()=>{const n=v.value.trim().toLowerCase();return[...d.sales].filter(s=>{var y;const e=!n||s.invoiceNumber.toLowerCase().includes(n)||((y=s.customerName)==null?void 0:y.toLowerCase().includes(n))||s.items.some(N=>N.name.toLowerCase().includes(n)),a=u.value==="all"||s.paymentType===u.value;return e&&a}).sort((s,e)=>new Date(e.datetime).getTime()-new Date(s.datetime).getTime())});function C(n){o.value=n,m.value=!0}function T(n){k.push({path:"/admin/refunds",query:{invoice:n.invoiceNumber}})}function S(n){globalThis.confirm(`Delete invoice #${n.invoiceNumber}? This action cannot be undone.`)&&d.deleteSale(n.id)}return(n,s)=>(l(),i(p,null,[t("div",j,[t("div",z,[t("div",H,[s[2]||(s[2]=t("div",null,[t("div",{class:"subtle-label"},"Sales & Refunds"),t("h2",{class:"section-heading"},"Sales History")],-1)),$(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>v.value=e),type:"search",placeholder:"Search invoice, customer, or product",class:"input-field w-full max-w-md"},null,512),[[F,v.value]])]),t("div",U,[(l(),i(p,null,x(w,e=>t("button",{key:e,class:L(["quick-filter",u.value===e?"bg-blue-600 text-white border-blue-600":""]),onClick:a=>u.value=e},c(e==="all"?"All Payments":e.charAt(0).toUpperCase()+e.slice(1)),11,J)),64))]),_.value.length===0?(l(),i("div",O," No invoices match your filters. ")):(l(),i("div",Q,[t("div",W,[t("table",G,[s[3]||(s[3]=t("thead",null,[t("tr",null,[t("th",null,"Invoice"),t("th",null,"Date & Time"),t("th",null,"Customer"),t("th",null,"Payment"),t("th",{class:"text-right"},"Total"),t("th",{class:"text-right"},"Refunded"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(l(!0),i(p,null,x(_.value,e=>(l(),i("tr",{key:e.id},[t("td",K,"#"+c(e.invoiceNumber),1),t("td",X,c(new Date(e.datetime).toLocaleString()),1),t("td",null,c(e.customerName||"Walk-in"),1),t("td",null,[t("span",Y,c(e.paymentType),1)]),t("td",Z," ₹"+c(e.total.toFixed(2)),1),t("td",ee,[f.value.get(e.id)?(l(),i("span",te," -₹"+c((f.value.get(e.id)||0).toFixed(2)),1)):(l(),i("span",se,"—"))]),t("td",ne,[t("div",oe,[t("button",{class:"btn-ghost text-xs px-3 py-1",onClick:a=>C(e)},"View / Print",8,ae),t("button",{class:"btn text-xs bg-emerald-50 text-emerald-700",onClick:a=>T(e)},"Refund",8,le),B(D).isAdmin?(l(),i("button",{key:0,class:"btn-danger text-xs px-3 py-1",onClick:a=>S(e)}," Delete ",8,ie)):g("",!0)])])]))),128))])])])]))])]),m.value&&o.value?(l(),I(E,{key:0,invoiceNumber:o.value.invoiceNumber,datetime:o.value.datetime,items:o.value.items.map(e=>({name:e.name,quantity:e.quantity,unitPrice:e.unitPrice,lineDiscount:e.lineDiscount??0,lineTotal:e.lineTotal??e.unitPrice*e.quantity})),subtotal:o.value.items.reduce((e,a)=>e+(a.lineTotal??a.unitPrice*a.quantity),0),productDiscountTotal:o.value.items.reduce((e,a)=>e+(a.lineDiscount??0),0),invoiceDiscountMode:o.value.invoiceDiscountMode,invoiceDiscountValue:o.value.invoiceDiscountValue,invoiceDiscountAmount:o.value.invoiceDiscountAmount,total:o.value.total,paymentType:o.value.paymentType,cashier:o.value.cashier,customerName:o.value.customerName,onClose:s[1]||(s[1]=e=>m.value=!1)},null,8,["invoiceNumber","datetime","items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","total","paymentType","cashier","customerName"])):g("",!0)],64))}});export{he as default};
