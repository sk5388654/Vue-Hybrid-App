import{d as X,r as M,c as F,o as m,a as x,b as e,w as L,v as ie,F as U,e as Q,t as c,n as B,f as R,g as W,m as ze,u as Oe,h as G,i as we,_ as Le,j as Ue,k as Be,l as He,p as Je,q as Ke,s as $e,x as Ge,y as Qe,z as Ye,A as Se,B as le,C as E,D as We,E as Xe,G as me,H as Ze,T as et,I as tt}from"./index-c52e9aa3.js";import{_ as st}from"./InvoiceModal.vue_vue_type_script_setup_true_lang-577b4280.js";import{u as ot}from"./settings-5aa1c8e3.js";import"./BarcodeDisplay.vue_vue_type_script_setup_true_lang-342f9936.js";import"./_commonjsHelpers-725317a4.js";import"./print-63d4994a.js";const nt={class:"rounded-lg p-4 flex flex-col h-full dark-panel"},lt={class:"mb-4 flex items-center sticky top-0 z-10 dark-panel"},it={class:"flex-1 overflow-y-auto pr-2"},at={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},dt=["src","alt"],ut={class:"mt-2 flex-1"},rt={class:"text-sm font-medium text-slate-100"},ct={class:"mt-1 text-sm text-slate-300"},vt=["disabled","onClick"],mt=X({__name:"ProductList",props:{products:{},disabled:{type:Boolean}},emits:["add"],setup($,{emit:T}){const k=$,C=T,w=M(""),r=F(()=>{const b=w.value.trim().toLowerCase();return b?k.products.filter(d=>d.name.toLowerCase().includes(b)):k.products});return(b,d)=>(m(),x("div",nt,[e("div",lt,[L(e("input",{"onUpdate:modelValue":d[0]||(d[0]=f=>w.value=f),type:"text",placeholder:"Search products...",class:"w-full input-field"},null,512),[[ie,w.value]])]),e("div",it,[e("div",at,[(m(!0),x(U,null,Q(r.value,f=>(m(),x("div",{key:f.id,class:"group flex flex-col rounded-lg p-3 dark-panel transition hover:shadow-md max-w-full"},[e("img",{src:f.image,alt:f.name,class:"w-full aspect-[3/2] rounded-md object-cover"},null,8,dt),e("div",ut,[e("div",rt,c(f.name),1),e("div",ct,"₹"+c(f.price),1),e("div",{class:B(["mt-1 text-xs",f.stock>0?"text-slate-400":"text-red-500 font-medium"])},c(f.stock>0?"Stock: "+f.stock:"Out of Stock"),3)]),e("button",{disabled:f.stock===0||k.disabled,onClick:_=>C("add",f),class:"mt-3 rounded-md bg-indigo-600 px-3 py-3 sm:py-2 text-sm font-medium text-slate-100 disabled:bg-gray-700 disabled:cursor-not-allowed w-full sm:w-auto",style:{"min-height":"44px"}}," Add to Cart ",8,vt)]))),128))])])]))}}),pt={class:"rounded-lg p-4 dark-panel"},ft={key:0,class:"text-sm text-slate-400"},xt={key:1,class:"-mx-2 divide-y divide-gray-100 dark:divide-slate-700"},bt=["onClick"],gt={class:"flex items-center gap-3"},kt=["src","alt"],yt={class:"flex-1"},ht={class:"text-sm font-medium text-slate-100"},Dt={class:"text-xs text-slate-400"},Ct={class:"text-xs text-slate-400"},wt={class:"text-xs font-semibold text-slate-100"},$t={class:"flex flex-col items-end gap-2"},St=["max","value","onInput","disabled"],_t=["onClick","disabled"],Mt={class:"grid grid-cols-2 gap-2"},Tt=["value","onChange","disabled"],It=["value","onInput","disabled"],Vt={key:2,class:"mt-4 space-y-3 rounded-lg p-4 dark-panel"},Nt={class:"flex items-center justify-between text-sm"},At={class:"font-medium text-slate-100 dark:text-slate-100"},Ft={class:"rounded-md p-3 dark-panel"},qt={class:"flex items-center justify-between gap-4 text-sm"},Rt={class:"flex items-center gap-2"},Et=["value","disabled"],jt=["value","disabled"],Pt={class:"mt-2 text-right text-xs text-slate-400"},zt={class:"flex items-center justify-between text-base font-semibold text-slate-100 dark:text-slate-100"},Ot=["disabled"],Lt=["disabled"],_e=X({__name:"Cart",props:{items:{},subtotal:{},invoiceDiscountMode:{},invoiceDiscountValue:{},invoiceDiscountAmount:{},grandTotal:{},selectedId:{},disabled:{type:Boolean}},emits:["updateQty","remove","checkout","hold","select","updateItemDiscount","updateInvoiceDiscountMode","updateInvoiceDiscountValue"],setup($,{emit:T}){const k=$,C=T,w=F(()=>k.items.length===0);function r(_,n){C("updateItemDiscount",{id:_,mode:n})}function b(_,n){const u=Number(n);C("updateItemDiscount",{id:_,value:Number.isNaN(u)?0:u})}function d(_){const n=_.target.value;C("updateInvoiceDiscountMode",n)}function f(_){const n=Number(_.target.value);C("updateInvoiceDiscountValue",Number.isNaN(n)?0:n)}return(_,n)=>(m(),x("div",pt,[n[14]||(n[14]=e("h2",{class:"mb-4 text-lg font-semibold text-slate-100"},"Cart",-1)),w.value?(m(),x("div",ft,"Your cart is empty.")):(m(),x("ul",xt,[(m(!0),x(U,null,Q(k.items,u=>(m(),x("li",{key:u.id,class:B(["flex flex-col gap-2 px-2 py-3 rounded-md transition-colors",$.selectedId===u.id?"dark:bg-[rgba(59,130,246,0.18)] dark:ring-2 dark:ring-indigo-500 bg-[rgba(59,130,246,0.08)] ring-2 ring-indigo-300":""]),onClick:S=>C("select",u.id)},[e("div",gt,[e("img",{src:u.image,alt:u.name,class:"h-12 w-12 rounded object-cover"},null,8,kt),e("div",yt,[e("div",ht,c(u.name),1),e("div",Dt,"Price Rs "+c(u.price.toFixed(2))+" × Qty "+c(u.quantity),1),e("div",Ct,"Line Discount Rs "+c(u.lineDiscount.toFixed(2)),1),e("div",wt,"Line Total Rs "+c(u.lineTotal.toFixed(2)),1)]),e("div",$t,[e("input",{type:"number",min:"1",max:u.stock,value:u.quantity,onClick:n[0]||(n[0]=W(()=>{},["stop"])),onInput:S=>C("updateQty",u.id,Number(S.target.value)),class:"w-20 rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,St),e("button",{onClick:W(S=>C("remove",u.id),["stop"]),class:"rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-xs text-slate-200 hover:dark-panel dark:border-slate-600/60 dark:text-slate-200 dark:hover:bg-slate-700/40",title:"Delete",disabled:k.disabled}," Remove ",8,_t)])]),e("div",Mt,[e("div",null,[n[8]||(n[8]=e("label",{class:"block text-xs text-slate-300 dark:text-slate-300"},"Discount Type",-1)),e("select",{value:u.discountMode,onClick:n[1]||(n[1]=W(()=>{},["stop"])),onChange:S=>r(u.id,S.target.value),class:"mt-1 w-full rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},[...n[7]||(n[7]=[e("option",{value:"flat"},"Flat",-1),e("option",{value:"percent"},"Percent",-1)])],40,Tt)]),e("div",null,[n[9]||(n[9]=e("label",{class:"block text-xs text-slate-300 dark:text-slate-300"},"Discount Value",-1)),e("input",{value:u.discountValue,type:"number",min:"0",step:"0.01",onClick:n[2]||(n[2]=W(()=>{},["stop"])),onInput:S=>b(u.id,S.target.value),class:"mt-1 w-full rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,It)])])],10,bt))),128))])),w.value?R("",!0):(m(),x("div",Vt,[e("div",Nt,[n[10]||(n[10]=e("span",{class:"text-slate-300 dark:text-slate-300"},"Subtotal",-1)),e("span",At,"Rs "+c($.subtotal.toFixed(2)),1)]),e("div",Ft,[e("div",qt,[n[12]||(n[12]=e("span",{class:"text-slate-300 dark:text-slate-300"},"Invoice Discount",-1)),e("div",Rt,[e("select",{value:$.invoiceDiscountMode,onChange:n[3]||(n[3]=u=>d(u)),class:"rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},[...n[11]||(n[11]=[e("option",{value:"flat"},"Flat",-1),e("option",{value:"percent"},"Percent",-1)])],40,Et),e("input",{value:$.invoiceDiscountValue,type:"number",min:"0",step:"0.01",onInput:n[4]||(n[4]=u=>f(u)),class:"w-24 rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,jt)])]),e("div",Pt,"Discount Amount: Rs "+c($.invoiceDiscountAmount.toFixed(2)),1)]),e("div",zt,[n[13]||(n[13]=e("span",null,"Grand Total",-1)),e("span",null,"Rs "+c($.grandTotal.toFixed(2)),1)])])),e("button",{disabled:w.value||k.disabled,onClick:n[5]||(n[5]=u=>C("checkout")),class:"mt-4 w-full rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-slate-100 disabled:cursor-not-allowed disabled:bg-gray-600",title:"Checkout"}," Checkout ",8,Ot),e("button",{disabled:w.value||k.disabled,onClick:n[6]||(n[6]=u=>C("hold")),class:"mt-2 w-full rounded-md border border-transparent px-4 py-2 text-sm font-medium text-slate-200 hover:bg-[rgba(255,255,255,0.02)] disabled:cursor-not-allowed disabled:opacity-60",title:"Hold Sale"}," Hold Sale ",8,Lt)]))}}),Ut={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4"},Bt={class:"w-full max-w-lg rounded-lg dark-panel"},Ht={class:"flex items-center justify-between border-b px-4 py-3"},Jt={class:"max-h-[60vh] overflow-y-auto p-4"},Kt={class:"text-sm text-slate-300"},Gt={class:"mt-3 divide-y divide-gray-100"},Qt={class:"flex items-center justify-between"},Yt={class:"text-slate-200"},Wt={class:"font-medium text-slate-100"},Xt={class:"flex justify-between text-xs text-slate-400"},Zt={class:"mt-4 space-y-2 text-sm"},es={class:"flex items-center justify-between"},ts={class:"font-medium text-slate-100"},ss={class:"flex items-center justify-between"},os={class:"font-medium text-slate-100"},ns={class:"flex items-center justify-between"},ls={class:"text-slate-300"},is={class:"font-medium text-slate-100"},as={class:"mt-3 flex items-center justify-between border-t pt-3"},ds={class:"text-base font-semibold text-slate-100"},us={class:"flex justify-end gap-2 border-t px-4 py-3"},rs=X({__name:"ReceiptModal",props:{items:{},subtotal:{},productDiscountTotal:{},invoiceDiscountMode:{},invoiceDiscountValue:{},invoiceDiscountAmount:{},grandTotal:{}},emits:["confirm","cancel"],setup($,{emit:T}){const k=$,C=T;return(w,r)=>(m(),x("div",Ut,[e("div",Bt,[e("div",Ht,[r[3]||(r[3]=e("h3",{class:"text-base font-semibold text-slate-100"},"Receipt",-1)),e("button",{class:"text-slate-400 hover:text-slate-200",onClick:r[0]||(r[0]=b=>C("cancel"))},"✕")]),e("div",Jt,[e("div",Kt,"Date/Time: "+c(new Date().toLocaleString()),1),e("ul",Gt,[(m(!0),x(U,null,Q(k.items,b=>(m(),x("li",{key:b.id,class:"py-2 text-sm"},[e("div",Qt,[e("span",Yt,c(b.name)+" × "+c(b.quantity),1),e("span",Wt,"Rs "+c(b.lineTotal.toFixed(2)),1)]),e("div",Xt,[e("span",null,"Gross: Rs "+c(b.gross.toFixed(2)),1),e("span",null,"Discount: Rs "+c(b.lineDiscount.toFixed(2)),1)])]))),128))]),e("div",Zt,[e("div",es,[r[4]||(r[4]=e("span",{class:"text-slate-300"},"Subtotal",-1)),e("span",ts,"Rs "+c($.subtotal.toFixed(2)),1)]),e("div",ss,[r[5]||(r[5]=e("span",{class:"text-slate-300"},"Product Discounts",-1)),e("span",os,"Rs "+c($.productDiscountTotal.toFixed(2)),1)]),e("div",ns,[e("span",ls," Invoice Discount ("+c($.invoiceDiscountMode==="percent"?`${$.invoiceDiscountValue}%`:`Rs ${$.invoiceDiscountValue}`)+") ",1),e("span",is,"Rs "+c($.invoiceDiscountAmount.toFixed(2)),1)])]),e("div",as,[r[6]||(r[6]=e("span",{class:"text-sm font-medium text-slate-200"},"Grand Total",-1)),e("span",ds,"Rs "+c($.grandTotal.toFixed(2)),1)])]),e("div",us,[e("button",{class:"rounded-md border border-[rgba(255,255,255,0.06)] px-4 py-2 text-sm text-slate-200 hover:dark-panel",onClick:r[1]||(r[1]=b=>C("cancel"))},"Cancel"),e("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700",onClick:r[2]||(r[2]=b=>C("confirm"))},"Confirm")])])]))}}),cs={class:"space-y-2"},vs={class:"flex gap-2 items-center"},ms={key:0,class:"fixed inset-0 z-40 flex items-center justify-center"},ps={class:"relative z-50 w-[340px] rounded-lg dark-panel p-4"},fs={class:"mb-3 flex items-center justify-between"},xs={class:"mb-2 rounded-md border border-transparent dark-panel px-3 py-2 text-right text-2xl font-mono text-slate-100"},bs={class:"grid grid-cols-4 gap-2"},gs=X({__name:"PaymentSelect",props:{modelValue:{required:!0},modelModifiers:{}},emits:ze(["apply-amount","open-resume"],["update:modelValue"]),setup($,{emit:T}){const k=Oe($,"modelValue"),C=T,w=M(!1),r=M("0");function b(D){r.value==="0"?r.value=D:r.value+=D}function d(){r.value.includes(".")||(r.value+=".")}function f(){r.value="0"}function _(){r.value.length<=1?r.value="0":r.value=r.value.slice(0,-1)}function n(D){const o=r.value.slice(-1);"+-*/".includes(o)?r.value=r.value.slice(0,-1)+D:r.value+=D}function u(){try{const o=r.value.replace(/[^0-9+\-*/().% ]/g,"").replace(/(\d+\.?\d*)%/g,"($1/100)"),g=Function(`return (${o})`)();Number.isFinite(g)&&(r.value=String(Number(g.toFixed(2))))}catch{}}function S(D){if(!w.value)return;const o=D.key;if(/^[0-9]$/.test(o)){D.preventDefault(),b(o);return}if(o==="."){D.preventDefault(),d();return}if(o==="Enter"||o==="="){D.preventDefault(),u();return}if(o==="Backspace"){D.preventDefault(),_();return}if(o==="Escape"){D.preventDefault(),w.value=!1;return}if(o==="+"||o==="-"||o==="*"||o==="/"){D.preventDefault(),n(o);return}if(o==="%"){D.preventDefault(),n("%");return}if(o.toLowerCase()==="c"){D.preventDefault(),f();return}}return G(w,D=>{D?window.addEventListener("keydown",S):window.removeEventListener("keydown",S)}),(D,o)=>(m(),x("div",cs,[o[25]||(o[25]=e("div",{class:"payment-label text-sm font-medium"},"Payment Type",-1)),e("div",vs,[e("button",{class:B([k.value==="cash"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:o[0]||(o[0]=g=>k.value="cash")},"Cash",2),e("button",{class:B([k.value==="card"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:o[1]||(o[1]=g=>k.value="card")},"Card",2),e("button",{class:B([k.value==="mobile"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:o[2]||(o[2]=g=>k.value="mobile")},"Mobile",2),e("button",{onClick:o[3]||(o[3]=g=>w.value=!0),class:"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md",title:"Open calculator"},[...o[22]||(o[22]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h8M8 11h8M8 15h8M5 5h14v14H5z"})],-1),we(" Calc ",-1)])]),e("button",{onClick:o[4]||(o[4]=g=>C("open-resume")),class:"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md",title:"Resume suspended sale"},[...o[23]||(o[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h4v4H3zM7 6h4v4H7zM11 10h4v4h-4zM15 6h4v4h-4zM3 14h4v4H3zM7 18h4v-4H7z"})],-1),we(" Resume Sale ",-1)])])]),w.value?(m(),x("div",ms,[e("div",{class:"absolute inset-0 bg-black/40",onClick:o[5]||(o[5]=g=>w.value=!1)}),e("div",ps,[e("div",fs,[o[24]||(o[24]=e("div",{class:"text-lg font-semibold text-slate-100"},"Calculator",-1)),e("button",{class:"text-sm text-slate-300",onClick:o[6]||(o[6]=g=>w.value=!1)},"Close")]),e("div",xs,c(r.value),1),e("div",bs,[e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:f},"C"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:_},"⌫"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[7]||(o[7]=g=>n("%"))},"%"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[8]||(o[8]=g=>n("/"))},"÷"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[9]||(o[9]=g=>b("7"))},"7"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[10]||(o[10]=g=>b("8"))},"8"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[11]||(o[11]=g=>b("9"))},"9"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[12]||(o[12]=g=>n("*"))},"×"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[13]||(o[13]=g=>b("4"))},"4"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[14]||(o[14]=g=>b("5"))},"5"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[15]||(o[15]=g=>b("6"))},"6"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[16]||(o[16]=g=>n("-"))},"−"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[17]||(o[17]=g=>b("1"))},"1"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[18]||(o[18]=g=>b("2"))},"2"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:o[19]||(o[19]=g=>b("3"))},"3"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:o[20]||(o[20]=g=>n("+"))},"+"),e("button",{class:"col-span-2 rounded dark-panel p-3 text-sm text-center text-slate-200",onClick:o[21]||(o[21]=g=>b("0"))},"0"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:d},"."),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:u},"=")]),e("div",{class:"mt-3 flex gap-2"},[e("button",{class:"flex-1 rounded dark-panel px-3 py-2 text-sm text-slate-200",onClick:f},"Clear")])])])):R("",!0)]))}});const ks=Le(gs,[["__scopeId","data-v-57d16423"]]),ys={class:"grid grid-cols-1 gap-6 lg:grid-cols-3"},hs={class:"lg:col-span-2"},Ds={class:"mb-3"},Cs={key:0,class:"mt-2 rounded-md border border-yellow-200 bg-yellow-50 px-3 py-2 text-sm text-yellow-800"},ws={class:"pr-2",style:{height:"680px",overflow:"hidden"}},$s={class:"hidden lg:block lg:col-span-1"},Ss={class:"mt-4 space-y-3"},_s={class:"rounded-lg border dark-panel p-3 shadow-sm"},Ms=["value"],Ts={key:0,class:"mt-2 text-xs text-slate-400"},Is={class:"rounded-lg border dark-panel p-3 shadow-sm"},Vs={key:0,class:"mt-2 flex items-center gap-2"},Ns={key:1,class:"mt-2 text-sm text-white bg-green-700 rounded px-2 py-1"},As={key:0,class:"rounded-lg border dark-panel p-3 shadow-sm"},Fs={class:"mb-2 flex items-center gap-2"},qs={key:0,class:"mt-2"},Rs=["max"],Es={class:"mt-1 text-xs text-slate-400"},js={class:"text-red-400"},Ps=["aria-expanded"],zs={class:"fixed inset-0 z-50 lg:hidden"},Os={id:"mobile-cart",role:"dialog","aria-modal":"true",class:"absolute left-0 right-0 bottom-0 z-50"},Ls={class:"flex items-center justify-between mb-3"},Us={class:"max-h-[60vh] overflow-auto"},Bs={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},Hs={class:"relative z-60 w-11/12 max-w-2xl rounded bg-white p-4 shadow-lg"},Js={class:"flex items-center justify-between mb-3"},Ks={class:"mb-3"},Gs={key:0,class:"text-sm text-gray-500"},Qs={key:1,class:"space-y-2 max-h-96 overflow-auto"},Ys={class:"flex items-start gap-3"},Ws={class:"flex-1"},Xs={class:"text-sm font-medium"},Zs={class:"text-xs text-gray-500"},eo={class:"mt-2 text-xs"},to={class:"flex flex-col gap-2"},so=["onClick"],oo=["onClick"],no=["onKeydown"],Me="posCart",pe="posSelectedCartItemId",lo="suspended_sales_",mo=X({__name:"PosView",setup($){const T=Ue(),k=Be(),C=He(),w=Je(),r=Ke();function b(){r.push("/closing")}const d=$e([]),f=M(null),_=M("cash"),n=M(null),u=M(!1),S=M(0),D=M("Cashier-1"),o=M(!1),g=M(!1),I=M(null),y=$e({mode:"flat",value:0}),H=F(()=>d.map(s=>{const t=s.price*s.quantity,i=Math.max(s.discountValue,0),a=s.discountMode==="percent"?t*Math.min(i,100)/100:i,V=Math.min(a,t),l=t-V;return{...s,gross:t,lineDiscount:V,lineTotal:l}})),j=F(()=>H.value.reduce((s,t)=>s+t.lineTotal,0)),Z=F(()=>H.value.reduce((s,t)=>s+t.lineDiscount,0)),z=F(()=>{const s=j.value;if(s<=0)return 0;if(y.mode==="percent"){const t=Math.min(Math.max(y.value,0),100);return s*t/100}return Math.min(Math.max(y.value,0),s)}),q=F(()=>Math.max(j.value-z.value,0)),Te=F(()=>Z.value+z.value),fe=F(()=>u.value?Math.max(0,q.value-S.value):0),ee=F(()=>C.customersForCurrentStore),te=F(()=>!!w.activeShift),N=M([]),Y=M(!1),se=ot(),ae=M(!1),oe=M(""),P=M(null),Ie=Ge(),de=M(""),Ve=F(()=>{const s=de.value.trim().toLowerCase();return s?N.value.filter(t=>(t.customerName||"").toLowerCase().includes(s)?!0:t.items.some(i=>i.name.toLowerCase().includes(s))):N.value});function xe(){const s=Ie.currentStoreId||"";return`${lo}${s}`}function ue(){try{localStorage.setItem(xe(),JSON.stringify(N.value))}catch{}}function be(){try{const s=localStorage.getItem(xe());if(!s){N.value=[];return}N.value=JSON.parse(s)}catch{N.value=[]}}function re(s){if(!w.activeShift){alert("Start a shift before adding items to the cart.");return}if(s.stock<1)return;const t=d.find(i=>i.id===s.id);if(t){t.quantity<s.stock&&(t.quantity+=1);return}d.push({id:s.id,name:s.name,price:s.price,quantity:1,stock:s.stock,image:s.image,discountMode:"flat",discountValue:0})}function Ne(){d.splice(0,d.length),f.value=null,n.value=null,u.value=!1,S.value=0,y.mode="flat",y.value=0}function ce(){var i;if(!d.length)return;const t={id:`hold_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,createdAt:new Date().toISOString(),items:d.map(a=>({...a})),subtotal:j.value,productDiscountTotal:Z.value,invoiceDiscountMode:y.mode,invoiceDiscountValue:y.value,invoiceDiscountAmount:z.value,total:q.value,paymentType:_.value,cashier:D.value,customerId:n.value,customerName:n.value?(i=C.customersForCurrentStore.find(a=>a.id===n.value))==null?void 0:i.fullName:void 0};N.value.push(t),ue(),Ne()}function Ae(s){const t=N.value.findIndex(a=>a.id===s);if(t===-1)return;const i=N.value[t];d.splice(0,d.length,...i.items.map(a=>({...a}))),y.mode=i.invoiceDiscountMode,y.value=i.invoiceDiscountValue,_.value=i.paymentType,n.value=i.customerId||null,N.value.splice(t,1),ue(),Y.value=!1}function Fe(s){const t=(s||"").trim();if(!t)return;const i=T.byBarcode,a=i.get(t);if(a){re(a);return}const V=t.replace(/^0+/,"");V&&i.get(V)&&re(i.get(V))}function qe(){const s=oe.value.trim();s&&Fe(s),oe.value="",se.scanEnabled&&P.value&&setTimeout(()=>P.value&&P.value.focus(),20)}function Re(s){const t=N.value.findIndex(i=>i.id===s);t!==-1&&(N.value.splice(t,1),ue())}function ge(s,t){const i=d.find(p=>p.id===s);if(!i)return;const a=T.products.find(p=>p.id===s),V=a?a.stock:i.stock,l=Math.max(1,Math.min(t,V));i.quantity=l}function ve(s){const t=d.findIndex(i=>i.id===s);t!==-1&&(d.splice(t,1),f.value===s&&(f.value=null))}function ke(s){const t=d.find(i=>i.id===s.id);if(t&&(s.mode&&(t.discountMode=s.mode,t.discountMode==="percent"&&t.discountValue>100&&(t.discountValue=100)),s.value!==void 0)){let i=Math.max(s.value,0);t.discountMode==="percent"&&i>100&&(i=100),t.discountValue=i}}function ye(s){y.mode=s,s==="percent"&&y.value>100&&(y.value=100),s==="flat"&&y.value>j.value&&(y.value=j.value)}function he(s){let t=Math.max(s,0);y.mode==="percent"&&t>100&&(t=100),y.value=t}function ne(){if(d.length){if(!w.activeShift){alert("Please start a shift before processing sales.");return}if(q.value<=0){alert("Grand total must be greater than zero.");return}typeof J<"u"&&J.value?(K(),setTimeout(()=>{o.value=!0},250)):o.value=!0}}function Ee(){const s=n.value?C.customersForCurrentStore.find(a=>a.id===n.value):null,t=fe.value,i=k.recordSale({datetime:new Date().toISOString(),items:H.value.map(a=>({id:a.id,name:a.name,quantity:a.quantity,unitPrice:a.price,discountMode:a.discountMode,discountValue:a.discountValue,lineDiscount:a.lineDiscount,lineTotal:a.lineTotal})),subtotal:j.value,productDiscountTotal:Z.value,invoiceDiscountMode:y.mode,invoiceDiscountValue:y.value,invoiceDiscountAmount:z.value,totalDiscount:Te.value,total:q.value,paymentType:_.value,cashier:D.value,customerId:n.value||void 0,customerName:(s==null?void 0:s.fullName)||void 0,dueAmount:t>0?t:void 0});T.decrementStock(d.map(a=>({id:a.id,quantity:a.quantity}))),d.splice(0,d.length),f.value=null,n.value=null,u.value=!1,S.value=0,y.mode="flat",y.value=0,o.value=!1,I.value={invoiceNumber:i.invoiceNumber,datetime:i.datetime,items:i.items.map(a=>({name:a.name,quantity:a.quantity,unitPrice:a.unitPrice,lineDiscount:a.lineDiscount,lineTotal:a.lineTotal})),subtotal:i.subtotal,productDiscountTotal:i.productDiscountTotal,invoiceDiscountMode:i.invoiceDiscountMode,invoiceDiscountValue:i.invoiceDiscountValue,invoiceDiscountAmount:i.invoiceDiscountAmount,total:i.total,paymentType:i.paymentType,cashier:i.cashier,customerName:i.customerName},localStorage.setItem("lastInvoice",JSON.stringify(I.value)),g.value=!0}function je(){o.value=!1}function De(s){f.value=s}function Ce(s){if(s.key==="F1"){s.preventDefault(),ne();return}if(s.key==="F2"){s.preventDefault(),ce();return}s.key==="Enter"&&!o.value&&d.length?(s.preventDefault(),ne()):s.key==="Delete"&&f.value!=null&&(s.preventDefault(),ve(f.value))}G(u,s=>{s?S.value=q.value:S.value=0}),G(()=>se.scanEnabled,s=>{s?(ae.value=!0,setTimeout(()=>{P.value&&P.value.focus()},50),setTimeout(()=>ae.value=!1,1600)):P.value&&P.value.blur()}),G(q,s=>{u.value&&S.value>s&&(S.value=s)}),G(d,s=>{localStorage.setItem(Me,JSON.stringify(s))},{deep:!0}),G(f,s=>{s==null?localStorage.removeItem(pe):localStorage.setItem(pe,String(s))}),Qe(()=>{T.load(),k.load(),C.load(),w.setCurrentStore();try{se.load()}catch{}const s=localStorage.getItem(Me);if(s)try{const l=JSON.parse(s);Array.isArray(l)&&d.splice(0,d.length,...l.map(p=>{const A=T.products.find(h=>h.id===p.id),v=A?A.stock:p.stock;return{id:p.id,name:p.name,price:p.price,quantity:Math.max(1,Math.min(p.quantity??1,v??1)),stock:v,image:p.image,discountMode:p.discountMode||"flat",discountValue:p.discountValue??0}}))}catch{}const t=localStorage.getItem(pe);if(t){const l=Number(t);f.value=Number.isFinite(l)?l:null}const i=localStorage.getItem("lastInvoice");if(i)try{I.value=JSON.parse(i)}catch{I.value=null}const a=localStorage.getItem("refundToCart");if(a)try{JSON.parse(a).forEach(({productId:p,quantity:A})=>{const v=T.products.find(h=>h.id===p);if(v){const h=d.find(O=>O.id===p);h?h.quantity=Math.min(h.quantity+A,v.stock):d.push({id:v.id,name:v.name,price:v.price,quantity:Math.min(A,v.stock),stock:v.stock,image:v.image,discountMode:"flat",discountValue:0})}}),localStorage.removeItem("refundToCart")}catch{}const V=localStorage.getItem("exchangeToCart");if(V)try{const l=JSON.parse(V);l.return.forEach(({productId:p,quantity:A})=>{const v=T.products.find(h=>h.id===p);if(v){const h=d.find(O=>O.id===p);h?h.quantity=Math.min(h.quantity+A,v.stock):d.push({id:v.id,name:v.name,price:v.price,quantity:Math.min(A,v.stock),stock:v.stock,image:v.image,discountMode:"flat",discountValue:0})}}),l.exchange.forEach(({productId:p,quantity:A})=>{if(A<0){const v=d.find(h=>h.id===p);if(v&&(v.quantity=Math.max(0,v.quantity+A),v.quantity===0)){const h=d.findIndex(O=>O.id===p);h!==-1&&d.splice(h,1)}}else{const v=T.products.find(h=>h.id===p);if(v){const h=d.find(O=>O.id===p);h?h.quantity=Math.min(h.quantity+A,v.stock):d.push({id:v.id,name:v.name,price:v.price,quantity:Math.min(A,v.stock),stock:v.stock,image:v.image,discountMode:"flat",discountValue:0})}}}),localStorage.removeItem("exchangeToCart")}catch{}window.addEventListener("keydown",Ce),be()});const{cartOpen:J,toggleCart:Pe,closeCart:K}=Ye();return Se(()=>{J.value&&K()}),Se(()=>{window.removeEventListener("keydown",Ce)}),(s,t)=>{var i,a,V;return m(),x(U,null,[e("div",ys,[e("section",hs,[e("div",Ds,[te.value?R("",!0):(m(),x("div",Cs,[e("div",{class:"flex items-center gap-2"},[t[14]||(t[14]=e("div",null,[e("strong",null,"Start a shift first:"),e("span",{class:"ml-1"},"Please start the shift before adding items to the cart.")],-1)),e("button",{type:"button",onClick:b,class:"ml-auto rounded px-2 py-1 text-sm font-semibold text-yellow-900 underline hover:no-underline"}," Go to Closing ")])]))]),e("div",ws,[le(mt,{class:"h-full",products:E(T).products,disabled:!te.value,onAdd:re},null,8,["products","disabled"])])]),e("aside",$s,[le(_e,{items:H.value,subtotal:j.value,invoiceDiscountMode:y.mode,invoiceDiscountValue:y.value,invoiceDiscountAmount:z.value,grandTotal:q.value,selectedId:f.value,disabled:!te.value,onSelect:De,onUpdateQty:ge,onRemove:ve,onCheckout:ne,onHold:ce,onUpdateItemDiscount:ke,onUpdateInvoiceDiscountMode:ye,onUpdateInvoiceDiscountValue:he},null,8,["items","subtotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal","selectedId","disabled"]),e("div",Ss,[e("div",_s,[t[16]||(t[16]=e("label",{class:"mb-2 block text-sm font-medium text-slate-300"},"Customer (Optional)",-1)),L(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),class:"w-full rounded-md border dark-panel px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:text-slate-100"},[t[15]||(t[15]=e("option",{value:null},"Walk-in Customer",-1)),(m(!0),x(U,null,Q(ee.value,l=>(m(),x("option",{key:l.id,value:l.id},c(l.fullName)+" ("+c(l.phone)+") ",9,Ms))),128))],512),[[We,n.value]]),n.value?(m(),x("div",Ts,[e("div",null,"Total Purchases: ₹"+c(((i=ee.value.find(l=>l.id===n.value))==null?void 0:i.totalPurchases.toFixed(2))||"0.00"),1),e("div",{class:B((a=ee.value.find(l=>l.id===n.value))!=null&&a.totalDue?"text-red-400":"text-green-400")}," Current Due: ₹"+c(((V=ee.value.find(l=>l.id===n.value))==null?void 0:V.totalDue.toFixed(2))||"0.00"),3)])):R("",!0)]),e("div",Is,[le(ks,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=l=>_.value=l),onApplyAmount:t[2]||(t[2]=l=>{S.value=l,u.value=!0}),onOpenResume:t[3]||(t[3]=()=>{be(),Y.value=!0})},null,8,["modelValue"]),E(se).scanEnabled?(m(),x("div",Vs,[...t[17]||(t[17]=[e("div",{class:"rounded bg-green-900 px-2 py-1 text-sm font-medium text-green-300"},"Scan Mode: ON",-1)])])):R("",!0),ae.value?(m(),x("div",Ns,"Scan Mode Activated")):R("",!0)]),n.value?(m(),x("div",As,[e("div",Fs,[L(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>u.value=l),type:"checkbox",id:"creditSale",class:"h-4 w-4 rounded border-slate-700 text-indigo-400 focus:ring-indigo-500"},null,512),[[Xe,u.value]]),t[18]||(t[18]=e("label",{for:"creditSale",class:"text-sm font-medium text-slate-300"},"Credit Sale",-1))]),u.value?(m(),x("div",qs,[t[19]||(t[19]=e("label",{class:"block text-sm text-slate-300"},"Amount Paid",-1)),L(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>S.value=l),type:"number",min:"0",max:q.value,step:"0.01",class:"mt-1 w-full rounded-md border dark-panel px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:text-slate-100"},null,8,Rs),[[ie,S.value,void 0,{number:!0}]]),e("div",Es,[e("div",null,"Grand Total: ₹"+c(q.value.toFixed(2)),1),e("div",js,"Due: ₹"+c(fe.value.toFixed(2)),1)])])):R("",!0)])):R("",!0)])])]),e("button",{class:"fixed z-40 bottom-20 right-4 inline-flex items-center justify-center rounded-full bg-green-600 text-white p-4 shadow-lg lg:hidden",onClick:t[6]||(t[6]=l=>E(Pe)()),"aria-controls":"mobile-cart","aria-expanded":E(J),title:"Toggle cart"},[...t[20]||(t[20]=[e("span",{class:"sr-only"},"Open cart",-1),e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor","stroke-width":"1.6",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h2l.4 2M7 13h10l4-8H5.4"})],-1),e("span",{class:"ml-2 hidden sm:inline"},"Cart",-1)])],8,Ps),(m(),me(et,{to:"body"},[L(e("div",zs,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[7]||(t[7]=(...l)=>E(K)&&E(K)(...l)),"aria-hidden":"true"}),e("div",Os,[e("div",{class:B(["transform transition-transform duration-300 bg-white dark:bg-slate-900 rounded-t-lg p-4",E(J)?"translate-y-0":"translate-y-full"])},[e("div",Ls,[t[21]||(t[21]=e("div",{class:"text-lg font-semibold"},"Cart",-1)),e("button",{onClick:t[8]||(t[8]=(...l)=>E(K)&&E(K)(...l)),class:"p-2"},"Close")]),e("div",Us,[le(_e,{items:H.value,subtotal:j.value,invoiceDiscountMode:y.mode,invoiceDiscountValue:y.value,invoiceDiscountAmount:z.value,grandTotal:q.value,selectedId:f.value,disabled:!te.value,onSelect:De,onUpdateQty:ge,onRemove:ve,onCheckout:ne,onHold:ce,onUpdateItemDiscount:ke,onUpdateInvoiceDiscountMode:ye,onUpdateInvoiceDiscountValue:he},null,8,["items","subtotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal","selectedId","disabled"])])],2)])],512),[[Ze,E(J)]])])),o.value?(m(),me(rs,{key:0,items:H.value,subtotal:j.value,productDiscountTotal:Z.value,invoiceDiscountMode:y.mode,invoiceDiscountValue:y.value,invoiceDiscountAmount:z.value,grandTotal:q.value,onConfirm:Ee,onCancel:je},null,8,["items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal"])):R("",!0),g.value&&I.value?(m(),me(st,{key:1,invoiceNumber:I.value.invoiceNumber,datetime:I.value.datetime,items:I.value.items,subtotal:I.value.subtotal,productDiscountTotal:I.value.productDiscountTotal,invoiceDiscountMode:I.value.invoiceDiscountMode,invoiceDiscountValue:I.value.invoiceDiscountValue,invoiceDiscountAmount:I.value.invoiceDiscountAmount,total:I.value.total,paymentType:I.value.paymentType,cashier:I.value.cashier,customerName:I.value.customerName,onClose:t[9]||(t[9]=l=>g.value=!1)},null,8,["invoiceNumber","datetime","items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","total","paymentType","cashier","customerName"])):R("",!0),Y.value?(m(),x("div",Bs,[e("div",{class:"absolute inset-0 bg-black/40",onClick:t[10]||(t[10]=l=>Y.value=!1)}),e("div",Hs,[e("div",Js,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold"},"Suspended Sales",-1)),e("button",{class:"text-sm text-gray-600",onClick:t[11]||(t[11]=l=>Y.value=!1)},"Close")]),e("div",Ks,[L(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>de.value=l),type:"text",placeholder:"Search suspended sales or items...",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"},null,512),[[ie,de.value]])]),N.value.length?(m(),x("ul",Qs,[(m(!0),x(U,null,Q(Ve.value,l=>(m(),x("li",{key:l.id,class:"rounded border p-3"},[e("div",Ys,[e("div",Ws,[e("div",Xs,c(l.customerName||"Walk-in")+" — "+c(l.total.toFixed(2))+" Rs",1),e("div",Zs,c(new Date(l.createdAt).toLocaleString()),1),e("div",eo,[(m(!0),x(U,null,Q(l.items,p=>(m(),x("div",{key:l.id+"_"+p.id},c(p.name)+" × "+c(p.quantity)+" — Rs "+c((p.price*p.quantity).toFixed(2)),1))),128))])]),e("div",to,[e("button",{onClick:p=>Ae(l.id),class:"rounded bg-green-600 px-3 py-1 text-white text-sm"},"Resume",8,so),e("button",{onClick:p=>Re(l.id),class:"rounded border px-3 py-1 text-sm"},"Delete",8,oo)])])]))),128))])):(m(),x("div",Gs,"No suspended sales."))])])):R("",!0),L(e("input",{ref_key:"scanInput",ref:P,"onUpdate:modelValue":t[13]||(t[13]=l=>oe.value=l),onKeydown:tt(W(qe,["prevent"]),["enter"]),"aria-hidden":"true",autocomplete:"off",tabindex:"-1",type:"text",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",opacity:"0"}},null,40,no),[[ie,oe.value]])],64)}}});export{mo as default};
