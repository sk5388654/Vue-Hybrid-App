import{d as Q,r as S,c as N,o as f,a as x,b as e,w as L,v as ee,F as P,e as U,t as c,n as O,f as F,g as G,m as qe,u as Re,h as B,i as fe,j as Ee,k as je,l as Pe,p as Oe,q as ze,s as xe,x as Le,y as Be,z as Ue,A as ie,B as He,C as Je,D as Ke,E as be,G as Ge}from"./index-bf582a4f.js";import{_ as Qe}from"./InvoiceModal.vue_vue_type_script_setup_true_lang-1573670e.js";import{_ as Ye}from"./_plugin-vue_export-helper-c27b6911.js";import"./BarcodeDisplay.vue_vue_type_script_setup_true_lang-9e9de9e9.js";import"./_commonjsHelpers-725317a4.js";import"./print-3a01aada.js";const We={class:"rounded-lg p-4 flex flex-col h-full dark-panel"},Xe={class:"mb-4 flex items-center sticky top-0 z-10 dark-panel"},Ze={class:"flex-1 overflow-y-auto pr-2"},et={class:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4"},tt=["src","alt"],st={class:"mt-2 flex-1"},ot={class:"text-sm font-medium text-slate-100"},nt={class:"mt-1 text-sm text-slate-300"},lt=["disabled","onClick"],at=Q({__name:"ProductList",props:{products:{},disabled:{type:Boolean}},emits:["add"],setup(C,{emit:M}){const k=C,D=M,w=S(""),g=N(()=>{const v=w.value.trim().toLowerCase();return v?k.products.filter(i=>i.name.toLowerCase().includes(v)):k.products});return(v,i)=>(f(),x("div",We,[e("div",Xe,[L(e("input",{"onUpdate:modelValue":i[0]||(i[0]=b=>w.value=b),type:"text",placeholder:"Search products...",class:"w-full input-field"},null,512),[[ee,w.value]])]),e("div",Ze,[e("div",et,[(f(!0),x(P,null,U(g.value,b=>(f(),x("div",{key:b.id,class:"group flex flex-col rounded-lg p-3 dark-panel transition hover:shadow-md"},[e("img",{src:b.image,alt:b.name,class:"h-28 w-full rounded-md object-cover"},null,8,tt),e("div",st,[e("div",ot,c(b.name),1),e("div",nt,"₹"+c(b.price),1),e("div",{class:O(["mt-1 text-xs",b.stock>0?"text-slate-400":"text-red-500 font-medium"])},c(b.stock>0?"Stock: "+b.stock:"Out of Stock"),3)]),e("button",{disabled:b.stock===0||k.disabled,onClick:_=>D("add",b),class:"mt-3 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-slate-100 disabled:bg-gray-700 disabled:cursor-not-allowed"}," Add to Cart ",8,lt)]))),128))])])]))}}),it={class:"rounded-lg p-4 dark-panel"},dt={key:0,class:"text-sm text-slate-400"},ut={key:1,class:"-mx-2 divide-y divide-gray-100 dark:divide-slate-700"},rt=["onClick"],ct={class:"flex items-center gap-3"},vt=["src","alt"],mt={class:"flex-1"},pt={class:"text-sm font-medium text-slate-100"},ft={class:"text-xs text-slate-400"},xt={class:"text-xs text-slate-400"},bt={class:"text-xs font-semibold text-slate-100"},gt={class:"flex flex-col items-end gap-2"},kt=["max","value","onInput","disabled"],yt=["onClick","disabled"],ht={class:"grid grid-cols-2 gap-2"},Dt=["value","onChange","disabled"],wt=["value","onInput","disabled"],Ct={key:2,class:"mt-4 space-y-3 rounded-lg p-4 dark-panel"},$t={class:"flex items-center justify-between text-sm"},St={class:"font-medium text-slate-100 dark:text-slate-100"},_t={class:"rounded-md p-3 dark-panel"},Mt={class:"flex items-center justify-between gap-4 text-sm"},Tt={class:"flex items-center gap-2"},It=["value","disabled"],Vt=["value","disabled"],Nt={class:"mt-2 text-right text-xs text-slate-400"},Ft={class:"flex items-center justify-between text-base font-semibold text-slate-100 dark:text-slate-100"},At=["disabled"],qt=["disabled"],Rt=Q({__name:"Cart",props:{items:{},subtotal:{},invoiceDiscountMode:{},invoiceDiscountValue:{},invoiceDiscountAmount:{},grandTotal:{},selectedId:{},disabled:{type:Boolean}},emits:["updateQty","remove","checkout","hold","select","updateItemDiscount","updateInvoiceDiscountMode","updateInvoiceDiscountValue"],setup(C,{emit:M}){const k=C,D=M,w=N(()=>k.items.length===0);function g(_,n){D("updateItemDiscount",{id:_,mode:n})}function v(_,n){const u=Number(n);D("updateItemDiscount",{id:_,value:Number.isNaN(u)?0:u})}function i(_){const n=_.target.value;D("updateInvoiceDiscountMode",n)}function b(_){const n=Number(_.target.value);D("updateInvoiceDiscountValue",Number.isNaN(n)?0:n)}return(_,n)=>(f(),x("div",it,[n[14]||(n[14]=e("h2",{class:"mb-4 text-lg font-semibold text-slate-100"},"Cart",-1)),w.value?(f(),x("div",dt,"Your cart is empty.")):(f(),x("ul",ut,[(f(!0),x(P,null,U(k.items,u=>(f(),x("li",{key:u.id,class:O(["flex flex-col gap-2 px-2 py-3 rounded-md transition-colors",C.selectedId===u.id?"dark:bg-[rgba(59,130,246,0.18)] dark:ring-2 dark:ring-indigo-500 bg-[rgba(59,130,246,0.08)] ring-2 ring-indigo-300":""]),onClick:$=>D("select",u.id)},[e("div",ct,[e("img",{src:u.image,alt:u.name,class:"h-12 w-12 rounded object-cover"},null,8,vt),e("div",mt,[e("div",pt,c(u.name),1),e("div",ft,"Price Rs "+c(u.price.toFixed(2))+" × Qty "+c(u.quantity),1),e("div",xt,"Line Discount Rs "+c(u.lineDiscount.toFixed(2)),1),e("div",bt,"Line Total Rs "+c(u.lineTotal.toFixed(2)),1)]),e("div",gt,[e("input",{type:"number",min:"1",max:u.stock,value:u.quantity,onClick:n[0]||(n[0]=G(()=>{},["stop"])),onInput:$=>D("updateQty",u.id,Number($.target.value)),class:"w-20 rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,kt),e("button",{onClick:G($=>D("remove",u.id),["stop"]),class:"rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-xs text-slate-200 hover:dark-panel dark:border-slate-600/60 dark:text-slate-200 dark:hover:bg-slate-700/40",title:"Delete",disabled:k.disabled}," Remove ",8,yt)])]),e("div",ht,[e("div",null,[n[8]||(n[8]=e("label",{class:"block text-xs text-slate-300 dark:text-slate-300"},"Discount Type",-1)),e("select",{value:u.discountMode,onClick:n[1]||(n[1]=G(()=>{},["stop"])),onChange:$=>g(u.id,$.target.value),class:"mt-1 w-full rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},[...n[7]||(n[7]=[e("option",{value:"flat"},"Flat",-1),e("option",{value:"percent"},"Percent",-1)])],40,Dt)]),e("div",null,[n[9]||(n[9]=e("label",{class:"block text-xs text-slate-300 dark:text-slate-300"},"Discount Value",-1)),e("input",{value:u.discountValue,type:"number",min:"0",step:"0.01",onClick:n[2]||(n[2]=G(()=>{},["stop"])),onInput:$=>v(u.id,$.target.value),class:"mt-1 w-full rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,wt)])])],10,rt))),128))])),w.value?F("",!0):(f(),x("div",Ct,[e("div",$t,[n[10]||(n[10]=e("span",{class:"text-slate-300 dark:text-slate-300"},"Subtotal",-1)),e("span",St,"Rs "+c(C.subtotal.toFixed(2)),1)]),e("div",_t,[e("div",Mt,[n[12]||(n[12]=e("span",{class:"text-slate-300 dark:text-slate-300"},"Invoice Discount",-1)),e("div",Tt,[e("select",{value:C.invoiceDiscountMode,onChange:n[3]||(n[3]=u=>i(u)),class:"rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},[...n[11]||(n[11]=[e("option",{value:"flat"},"Flat",-1),e("option",{value:"percent"},"Percent",-1)])],40,It),e("input",{value:C.invoiceDiscountValue,type:"number",min:"0",step:"0.01",onInput:n[4]||(n[4]=u=>b(u)),class:"w-24 rounded-md border border-[rgba(255,255,255,0.06)] px-2 py-1 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-slate-600/60 dark:bg-slate-700/50 dark:text-slate-100",disabled:k.disabled},null,40,Vt)])]),e("div",Nt,"Discount Amount: Rs "+c(C.invoiceDiscountAmount.toFixed(2)),1)]),e("div",Ft,[n[13]||(n[13]=e("span",null,"Grand Total",-1)),e("span",null,"Rs "+c(C.grandTotal.toFixed(2)),1)])])),e("button",{disabled:w.value||k.disabled,onClick:n[5]||(n[5]=u=>D("checkout")),class:"mt-4 w-full rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-slate-100 disabled:cursor-not-allowed disabled:bg-gray-600",title:"Checkout"}," Checkout ",8,At),e("button",{disabled:w.value||k.disabled,onClick:n[6]||(n[6]=u=>D("hold")),class:"mt-2 w-full rounded-md border border-transparent px-4 py-2 text-sm font-medium text-slate-200 hover:bg-[rgba(255,255,255,0.02)] disabled:cursor-not-allowed disabled:opacity-60",title:"Hold Sale"}," Hold Sale ",8,qt)]))}}),Et={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4"},jt={class:"w-full max-w-lg rounded-lg dark-panel"},Pt={class:"flex items-center justify-between border-b px-4 py-3"},Ot={class:"max-h-[60vh] overflow-y-auto p-4"},zt={class:"text-sm text-slate-300"},Lt={class:"mt-3 divide-y divide-gray-100"},Bt={class:"flex items-center justify-between"},Ut={class:"text-slate-200"},Ht={class:"font-medium text-slate-100"},Jt={class:"flex justify-between text-xs text-slate-400"},Kt={class:"mt-4 space-y-2 text-sm"},Gt={class:"flex items-center justify-between"},Qt={class:"font-medium text-slate-100"},Yt={class:"flex items-center justify-between"},Wt={class:"font-medium text-slate-100"},Xt={class:"flex items-center justify-between"},Zt={class:"text-slate-300"},es={class:"font-medium text-slate-100"},ts={class:"mt-3 flex items-center justify-between border-t pt-3"},ss={class:"text-base font-semibold text-slate-100"},os={class:"flex justify-end gap-2 border-t px-4 py-3"},ns=Q({__name:"ReceiptModal",props:{items:{},subtotal:{},productDiscountTotal:{},invoiceDiscountMode:{},invoiceDiscountValue:{},invoiceDiscountAmount:{},grandTotal:{}},emits:["confirm","cancel"],setup(C,{emit:M}){const k=C,D=M;return(w,g)=>(f(),x("div",Et,[e("div",jt,[e("div",Pt,[g[3]||(g[3]=e("h3",{class:"text-base font-semibold text-slate-100"},"Receipt",-1)),e("button",{class:"text-slate-400 hover:text-slate-200",onClick:g[0]||(g[0]=v=>D("cancel"))},"✕")]),e("div",Ot,[e("div",zt,"Date/Time: "+c(new Date().toLocaleString()),1),e("ul",Lt,[(f(!0),x(P,null,U(k.items,v=>(f(),x("li",{key:v.id,class:"py-2 text-sm"},[e("div",Bt,[e("span",Ut,c(v.name)+" × "+c(v.quantity),1),e("span",Ht,"Rs "+c(v.lineTotal.toFixed(2)),1)]),e("div",Jt,[e("span",null,"Gross: Rs "+c(v.gross.toFixed(2)),1),e("span",null,"Discount: Rs "+c(v.lineDiscount.toFixed(2)),1)])]))),128))]),e("div",Kt,[e("div",Gt,[g[4]||(g[4]=e("span",{class:"text-slate-300"},"Subtotal",-1)),e("span",Qt,"Rs "+c(C.subtotal.toFixed(2)),1)]),e("div",Yt,[g[5]||(g[5]=e("span",{class:"text-slate-300"},"Product Discounts",-1)),e("span",Wt,"Rs "+c(C.productDiscountTotal.toFixed(2)),1)]),e("div",Xt,[e("span",Zt," Invoice Discount ("+c(C.invoiceDiscountMode==="percent"?`${C.invoiceDiscountValue}%`:`Rs ${C.invoiceDiscountValue}`)+") ",1),e("span",es,"Rs "+c(C.invoiceDiscountAmount.toFixed(2)),1)])]),e("div",ts,[g[6]||(g[6]=e("span",{class:"text-sm font-medium text-slate-200"},"Grand Total",-1)),e("span",ss,"Rs "+c(C.grandTotal.toFixed(2)),1)])]),e("div",os,[e("button",{class:"rounded-md border border-[rgba(255,255,255,0.06)] px-4 py-2 text-sm text-slate-200 hover:dark-panel",onClick:g[1]||(g[1]=v=>D("cancel"))},"Cancel"),e("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700",onClick:g[2]||(g[2]=v=>D("confirm"))},"Confirm")])])]))}}),ls={class:"space-y-2"},as={class:"flex gap-2 items-center"},is=["title"],ds={class:"text-sm"},us={key:0,class:"fixed inset-0 z-40 flex items-center justify-center"},rs={class:"relative z-50 w-[340px] rounded-lg dark-panel p-4"},cs={class:"mb-3 flex items-center justify-between"},vs={class:"mb-2 rounded-md border border-transparent dark-panel px-3 py-2 text-right text-2xl font-mono text-slate-100"},ms={class:"grid grid-cols-4 gap-2"},ps=Q({__name:"PaymentSelect",props:{modelValue:{required:!0},modelModifiers:{}},emits:qe(["apply-amount","open-resume","toggle-scan"],["update:modelValue"]),setup(C,{emit:M}){const k=Re(C,"modelValue"),D=M,w=S(!1),g=S(!1),v=S("0");function i(y){v.value==="0"?v.value=y:v.value+=y}function b(){v.value.includes(".")||(v.value+=".")}function _(){v.value="0"}function n(){v.value.length<=1?v.value="0":v.value=v.value.slice(0,-1)}function u(y){const s=v.value.slice(-1);"+-*/".includes(s)?v.value=v.value.slice(0,-1)+y:v.value+=y}function $(){try{const s=v.value.replace(/[^0-9+\-*/().% ]/g,"").replace(/(\d+\.?\d*)%/g,"($1/100)"),d=Function(`return (${s})`)();Number.isFinite(d)&&(v.value=String(Number(d.toFixed(2))))}catch{}}function H(y){if(!w.value)return;const s=y.key;if(/^[0-9]$/.test(s)){y.preventDefault(),i(s);return}if(s==="."){y.preventDefault(),b();return}if(s==="Enter"||s==="="){y.preventDefault(),$();return}if(s==="Backspace"){y.preventDefault(),n();return}if(s==="Escape"){y.preventDefault(),w.value=!1;return}if(s==="+"||s==="-"||s==="*"||s==="/"){y.preventDefault(),u(s);return}if(s==="%"){y.preventDefault(),u("%");return}if(s.toLowerCase()==="c"){y.preventDefault(),_();return}}B(w,y=>{y?window.addEventListener("keydown",H):window.removeEventListener("keydown",H)});function E(){g.value=!g.value,D("toggle-scan",g.value)}return(y,s)=>(f(),x("div",ls,[s[26]||(s[26]=e("div",{class:"payment-label text-sm font-medium"},"Payment Type",-1)),e("div",as,[e("button",{class:O([k.value==="cash"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:s[0]||(s[0]=d=>k.value="cash")},"Cash",2),e("button",{class:O([k.value==="card"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:s[1]||(s[1]=d=>k.value="card")},"Card",2),e("button",{class:O([k.value==="mobile"?"bg-green-600 text-white":"dark-panel payment-btn","rounded-md px-3 py-1 text-sm"]),onClick:s[2]||(s[2]=d=>k.value="mobile")},"Mobile",2),e("button",{onClick:s[3]||(s[3]=d=>w.value=!0),class:"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md",title:"Open calculator"},[...s[22]||(s[22]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h8M8 11h8M8 15h8M5 5h14v14H5z"})],-1),fe(" Calc ",-1)])]),e("button",{onClick:s[4]||(s[4]=d=>D("open-resume")),class:"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md",title:"Resume suspended sale"},[...s[23]||(s[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h4v4H3zM7 6h4v4H7zM11 10h4v4h-4zM15 6h4v4h-4zM3 14h4v4H3zM7 18h4v-4H7z"})],-1),fe(" Resume Sale ",-1)])]),e("button",{onClick:E,class:O(g.value?"ml-2 inline-flex items-center gap-2 rounded-md border border-green-600 bg-green-600/20 px-3 py-1 text-sm text-green-400 shadow-sm":"ml-2 inline-flex items-center gap-2 rounded-md border border-transparent dark-panel px-3 py-1 text-sm payment-btn shadow-sm hover:shadow-md"),title:g.value?"Disable Scan Mode":"Enable Scan Mode"},[s[24]||(s[24]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7h18M3 12h18M3 17h18"})],-1)),e("span",ds,c(g.value?"Scan: ON":"Scan: OFF"),1)],10,is)]),w.value?(f(),x("div",us,[e("div",{class:"absolute inset-0 bg-black/40",onClick:s[5]||(s[5]=d=>w.value=!1)}),e("div",rs,[e("div",cs,[s[25]||(s[25]=e("div",{class:"text-lg font-semibold text-slate-100"},"Calculator",-1)),e("button",{class:"text-sm text-slate-300",onClick:s[6]||(s[6]=d=>w.value=!1)},"Close")]),e("div",vs,c(v.value),1),e("div",ms,[e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:_},"C"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:n},"⌫"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[7]||(s[7]=d=>u("%"))},"%"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:s[8]||(s[8]=d=>u("/"))},"÷"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[9]||(s[9]=d=>i("7"))},"7"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[10]||(s[10]=d=>i("8"))},"8"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[11]||(s[11]=d=>i("9"))},"9"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:s[12]||(s[12]=d=>u("*"))},"×"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[13]||(s[13]=d=>i("4"))},"4"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[14]||(s[14]=d=>i("5"))},"5"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[15]||(s[15]=d=>i("6"))},"6"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:s[16]||(s[16]=d=>u("-"))},"−"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[17]||(s[17]=d=>i("1"))},"1"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[18]||(s[18]=d=>i("2"))},"2"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:s[19]||(s[19]=d=>i("3"))},"3"),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:s[20]||(s[20]=d=>u("+"))},"+"),e("button",{class:"col-span-2 rounded dark-panel p-3 text-sm text-center text-slate-200",onClick:s[21]||(s[21]=d=>i("0"))},"0"),e("button",{class:"rounded dark-panel p-3 text-sm text-slate-200",onClick:b},"."),e("button",{class:"rounded bg-indigo-600 p-3 text-sm text-white",onClick:$},"=")]),e("div",{class:"mt-3 flex gap-2"},[e("button",{class:"flex-1 rounded dark-panel px-3 py-2 text-sm text-slate-200",onClick:_},"Clear")])])])):F("",!0)]))}});const fs=Ye(ps,[["__scopeId","data-v-b4c25232"]]),xs={class:"grid grid-cols-1 gap-6 lg:grid-cols-3"},bs={class:"lg:col-span-2"},gs={class:"mb-3"},ks={key:0,class:"mt-2 rounded-md border border-yellow-200 bg-yellow-50 px-3 py-2 text-sm text-yellow-800"},ys={class:"pr-2",style:{height:"680px",overflow:"hidden"}},hs={class:"lg:col-span-1"},Ds={class:"mt-4 space-y-3"},ws={class:"rounded-lg border dark-panel p-3 shadow-sm"},Cs=["value"],$s={key:0,class:"mt-2 text-xs text-slate-400"},Ss={class:"rounded-lg border dark-panel p-3 shadow-sm"},_s={key:0,class:"mt-2 flex items-center gap-2"},Ms={key:1,class:"mt-2 text-sm text-white bg-green-700 rounded px-2 py-1"},Ts={key:0,class:"rounded-lg border dark-panel p-3 shadow-sm"},Is={class:"mb-2 flex items-center gap-2"},Vs={key:0,class:"mt-2"},Ns=["max"],Fs={class:"mt-1 text-xs text-slate-400"},As={class:"text-red-400"},qs={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},Rs={class:"relative z-60 w-11/12 max-w-2xl rounded bg-white p-4 shadow-lg"},Es={class:"flex items-center justify-between mb-3"},js={class:"mb-3"},Ps={key:0,class:"text-sm text-gray-500"},Os={key:1,class:"space-y-2 max-h-96 overflow-auto"},zs={class:"flex items-start gap-3"},Ls={class:"flex-1"},Bs={class:"text-sm font-medium"},Us={class:"text-xs text-gray-500"},Hs={class:"mt-2 text-xs"},Js={class:"flex flex-col gap-2"},Ks=["onClick"],Gs=["onClick"],Qs=["onKeydown"],ge="posCart",de="posSelectedCartItemId",Ys="suspended_sales_",oo=Q({__name:"PosView",setup(C){const M=Ee(),k=je(),D=Pe(),w=Oe(),g=ze();function v(){g.push("/closing")}const i=xe([]),b=S(null),_=S("cash"),n=S(null),u=S(!1),$=S(0),H=S("Cashier-1"),E=S(!1),y=S(!1),s=S(null),d=xe({mode:"flat",value:0}),J=N(()=>i.map(t=>{const o=t.price*t.quantity,l=Math.max(t.discountValue,0),r=t.discountMode==="percent"?o*Math.min(l,100)/100:l,T=Math.min(r,o),a=o-T;return{...t,gross:o,lineDiscount:T,lineTotal:a}})),q=N(()=>J.value.reduce((t,o)=>t+o.lineTotal,0)),Y=N(()=>J.value.reduce((t,o)=>t+o.lineDiscount,0)),z=N(()=>{const t=q.value;if(t<=0)return 0;if(d.mode==="percent"){const o=Math.min(Math.max(d.value,0),100);return t*o/100}return Math.min(Math.max(d.value,0),t)}),A=N(()=>Math.max(q.value-z.value,0)),ke=N(()=>Y.value+z.value),ue=N(()=>u.value?Math.max(0,A.value-$.value):0),W=N(()=>D.customersForCurrentStore),te=N(()=>!!w.activeShift),I=S([]),K=S(!1),X=S(!1),se=S(!1),Z=S(""),R=S(null),ye=Le(),oe=S(""),he=N(()=>{const t=oe.value.trim().toLowerCase();return t?I.value.filter(o=>(o.customerName||"").toLowerCase().includes(t)?!0:o.items.some(l=>l.name.toLowerCase().includes(t))):I.value});function re(){const t=ye.currentStoreId||"";return`${Ys}${t}`}function ne(){try{localStorage.setItem(re(),JSON.stringify(I.value))}catch{}}function ce(){try{const t=localStorage.getItem(re());if(!t){I.value=[];return}I.value=JSON.parse(t)}catch{I.value=[]}}function le(t){if(!w.activeShift){alert("Start a shift before adding items to the cart.");return}if(t.stock<1)return;const o=i.find(l=>l.id===t.id);if(o){o.quantity<t.stock&&(o.quantity+=1);return}i.push({id:t.id,name:t.name,price:t.price,quantity:1,stock:t.stock,image:t.image,discountMode:"flat",discountValue:0})}function De(){i.splice(0,i.length),b.value=null,n.value=null,u.value=!1,$.value=0,d.mode="flat",d.value=0}function ve(){var l;if(!i.length)return;const o={id:`hold_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,createdAt:new Date().toISOString(),items:i.map(r=>({...r})),subtotal:q.value,productDiscountTotal:Y.value,invoiceDiscountMode:d.mode,invoiceDiscountValue:d.value,invoiceDiscountAmount:z.value,total:A.value,paymentType:_.value,cashier:H.value,customerId:n.value,customerName:n.value?(l=D.customersForCurrentStore.find(r=>r.id===n.value))==null?void 0:l.fullName:void 0};I.value.push(o),ne(),De()}function we(t){const o=I.value.findIndex(r=>r.id===t);if(o===-1)return;const l=I.value[o];i.splice(0,i.length,...l.items.map(r=>({...r}))),d.mode=l.invoiceDiscountMode,d.value=l.invoiceDiscountValue,_.value=l.paymentType,n.value=l.customerId||null,I.value.splice(o,1),ne(),K.value=!1}function Ce(t){const o=(t||"").trim();if(!o)return;const l=M.byBarcode,r=l.get(o);if(r){le(r);return}const T=o.replace(/^0+/,"");T&&l.get(T)&&le(l.get(T))}function $e(){const t=Z.value.trim();t&&Ce(t),Z.value="",X.value&&R.value&&setTimeout(()=>R.value&&R.value.focus(),20)}function Se(t){X.value=!!t}function _e(t){const o=I.value.findIndex(l=>l.id===t);o!==-1&&(I.value.splice(o,1),ne())}function Me(t,o){const l=i.find(p=>p.id===t);if(!l)return;const r=M.products.find(p=>p.id===t),T=r?r.stock:l.stock,a=Math.max(1,Math.min(o,T));l.quantity=a}function me(t){const o=i.findIndex(l=>l.id===t);o!==-1&&(i.splice(o,1),b.value===t&&(b.value=null))}function Te(t){const o=i.find(l=>l.id===t.id);if(o&&(t.mode&&(o.discountMode=t.mode,o.discountMode==="percent"&&o.discountValue>100&&(o.discountValue=100)),t.value!==void 0)){let l=Math.max(t.value,0);o.discountMode==="percent"&&l>100&&(l=100),o.discountValue=l}}function Ie(t){d.mode=t,t==="percent"&&d.value>100&&(d.value=100),t==="flat"&&d.value>q.value&&(d.value=q.value)}function Ve(t){let o=Math.max(t,0);d.mode==="percent"&&o>100&&(o=100),d.value=o}function ae(){if(i.length){if(!w.activeShift){alert("Please start a shift before processing sales.");return}if(A.value<=0){alert("Grand total must be greater than zero.");return}E.value=!0}}function Ne(){const t=n.value?D.customersForCurrentStore.find(r=>r.id===n.value):null,o=ue.value,l=k.recordSale({datetime:new Date().toISOString(),items:J.value.map(r=>({id:r.id,name:r.name,quantity:r.quantity,unitPrice:r.price,discountMode:r.discountMode,discountValue:r.discountValue,lineDiscount:r.lineDiscount,lineTotal:r.lineTotal})),subtotal:q.value,productDiscountTotal:Y.value,invoiceDiscountMode:d.mode,invoiceDiscountValue:d.value,invoiceDiscountAmount:z.value,totalDiscount:ke.value,total:A.value,paymentType:_.value,cashier:H.value,customerId:n.value||void 0,customerName:(t==null?void 0:t.fullName)||void 0,dueAmount:o>0?o:void 0});M.decrementStock(i.map(r=>({id:r.id,quantity:r.quantity}))),i.splice(0,i.length),b.value=null,n.value=null,u.value=!1,$.value=0,d.mode="flat",d.value=0,E.value=!1,s.value={invoiceNumber:l.invoiceNumber,datetime:l.datetime,items:l.items.map(r=>({name:r.name,quantity:r.quantity,unitPrice:r.unitPrice,lineDiscount:r.lineDiscount,lineTotal:r.lineTotal})),subtotal:l.subtotal,productDiscountTotal:l.productDiscountTotal,invoiceDiscountMode:l.invoiceDiscountMode,invoiceDiscountValue:l.invoiceDiscountValue,invoiceDiscountAmount:l.invoiceDiscountAmount,total:l.total,paymentType:l.paymentType,cashier:l.cashier,customerName:l.customerName},localStorage.setItem("lastInvoice",JSON.stringify(s.value)),y.value=!0}function Fe(){E.value=!1}function Ae(t){b.value=t}function pe(t){if(t.key==="F1"){t.preventDefault(),ae();return}if(t.key==="F2"){t.preventDefault(),ve();return}t.key==="Enter"&&!E.value&&i.length?(t.preventDefault(),ae()):t.key==="Delete"&&b.value!=null&&(t.preventDefault(),me(b.value))}return B(u,t=>{t?$.value=A.value:$.value=0}),B(X,t=>{t?(se.value=!0,setTimeout(()=>{R.value&&R.value.focus()},50),setTimeout(()=>se.value=!1,1600)):R.value&&R.value.blur()}),B(A,t=>{u.value&&$.value>t&&($.value=t)}),B(i,t=>{localStorage.setItem(ge,JSON.stringify(t))},{deep:!0}),B(b,t=>{t==null?localStorage.removeItem(de):localStorage.setItem(de,String(t))}),Be(()=>{M.load(),k.load(),D.load(),w.setCurrentStore();const t=localStorage.getItem(ge);if(t)try{const a=JSON.parse(t);Array.isArray(a)&&i.splice(0,i.length,...a.map(p=>{const V=M.products.find(h=>h.id===p.id),m=V?V.stock:p.stock;return{id:p.id,name:p.name,price:p.price,quantity:Math.max(1,Math.min(p.quantity??1,m??1)),stock:m,image:p.image,discountMode:p.discountMode||"flat",discountValue:p.discountValue??0}}))}catch{}const o=localStorage.getItem(de);if(o){const a=Number(o);b.value=Number.isFinite(a)?a:null}const l=localStorage.getItem("lastInvoice");if(l)try{s.value=JSON.parse(l)}catch{s.value=null}const r=localStorage.getItem("refundToCart");if(r)try{JSON.parse(r).forEach(({productId:p,quantity:V})=>{const m=M.products.find(h=>h.id===p);if(m){const h=i.find(j=>j.id===p);h?h.quantity=Math.min(h.quantity+V,m.stock):i.push({id:m.id,name:m.name,price:m.price,quantity:Math.min(V,m.stock),stock:m.stock,image:m.image,discountMode:"flat",discountValue:0})}}),localStorage.removeItem("refundToCart")}catch{}const T=localStorage.getItem("exchangeToCart");if(T)try{const a=JSON.parse(T);a.return.forEach(({productId:p,quantity:V})=>{const m=M.products.find(h=>h.id===p);if(m){const h=i.find(j=>j.id===p);h?h.quantity=Math.min(h.quantity+V,m.stock):i.push({id:m.id,name:m.name,price:m.price,quantity:Math.min(V,m.stock),stock:m.stock,image:m.image,discountMode:"flat",discountValue:0})}}),a.exchange.forEach(({productId:p,quantity:V})=>{if(V<0){const m=i.find(h=>h.id===p);if(m&&(m.quantity=Math.max(0,m.quantity+V),m.quantity===0)){const h=i.findIndex(j=>j.id===p);h!==-1&&i.splice(h,1)}}else{const m=M.products.find(h=>h.id===p);if(m){const h=i.find(j=>j.id===p);h?h.quantity=Math.min(h.quantity+V,m.stock):i.push({id:m.id,name:m.name,price:m.price,quantity:Math.min(V,m.stock),stock:m.stock,image:m.image,discountMode:"flat",discountValue:0})}}}),localStorage.removeItem("exchangeToCart")}catch{}window.addEventListener("keydown",pe),ce()}),Ue(()=>{window.removeEventListener("keydown",pe)}),(t,o)=>{var l,r,T;return f(),x(P,null,[e("div",xs,[e("section",bs,[e("div",gs,[te.value?F("",!0):(f(),x("div",ks,[e("div",{class:"flex items-center gap-2"},[o[11]||(o[11]=e("div",null,[e("strong",null,"Start a shift first:"),e("span",{class:"ml-1"},"Please start the shift before adding items to the cart.")],-1)),e("button",{type:"button",onClick:v,class:"ml-auto rounded px-2 py-1 text-sm font-semibold text-yellow-900 underline hover:no-underline"}," Go to Closing ")])]))]),e("div",ys,[ie(at,{class:"h-full",products:He(M).products,disabled:!te.value,onAdd:le},null,8,["products","disabled"])])]),e("aside",hs,[ie(Rt,{items:J.value,subtotal:q.value,invoiceDiscountMode:d.mode,invoiceDiscountValue:d.value,invoiceDiscountAmount:z.value,grandTotal:A.value,selectedId:b.value,disabled:!te.value,onSelect:Ae,onUpdateQty:Me,onRemove:me,onCheckout:ae,onHold:ve,onUpdateItemDiscount:Te,onUpdateInvoiceDiscountMode:Ie,onUpdateInvoiceDiscountValue:Ve},null,8,["items","subtotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal","selectedId","disabled"]),e("div",Ds,[e("div",ws,[o[13]||(o[13]=e("label",{class:"mb-2 block text-sm font-medium text-slate-300"},"Customer (Optional)",-1)),L(e("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>n.value=a),class:"w-full rounded-md border dark-panel px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:text-slate-100"},[o[12]||(o[12]=e("option",{value:null},"Walk-in Customer",-1)),(f(!0),x(P,null,U(W.value,a=>(f(),x("option",{key:a.id,value:a.id},c(a.fullName)+" ("+c(a.phone)+") ",9,Cs))),128))],512),[[Je,n.value]]),n.value?(f(),x("div",$s,[e("div",null,"Total Purchases: ₹"+c(((l=W.value.find(a=>a.id===n.value))==null?void 0:l.totalPurchases.toFixed(2))||"0.00"),1),e("div",{class:O((r=W.value.find(a=>a.id===n.value))!=null&&r.totalDue?"text-red-400":"text-green-400")}," Current Due: ₹"+c(((T=W.value.find(a=>a.id===n.value))==null?void 0:T.totalDue.toFixed(2))||"0.00"),3)])):F("",!0)]),e("div",Ss,[ie(fs,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=a=>_.value=a),onApplyAmount:o[2]||(o[2]=a=>{$.value=a,u.value=!0}),onOpenResume:o[3]||(o[3]=()=>{ce(),K.value=!0}),onToggleScan:Se},null,8,["modelValue"]),X.value?(f(),x("div",_s,[...o[14]||(o[14]=[e("div",{class:"rounded bg-green-900 px-2 py-1 text-sm font-medium text-green-300"},"Scan Mode: ON",-1)])])):F("",!0),se.value?(f(),x("div",Ms,"Scan Mode Activated")):F("",!0)]),n.value?(f(),x("div",Ts,[e("div",Is,[L(e("input",{"onUpdate:modelValue":o[4]||(o[4]=a=>u.value=a),type:"checkbox",id:"creditSale",class:"h-4 w-4 rounded border-slate-700 text-indigo-400 focus:ring-indigo-500"},null,512),[[Ke,u.value]]),o[15]||(o[15]=e("label",{for:"creditSale",class:"text-sm font-medium text-slate-300"},"Credit Sale",-1))]),u.value?(f(),x("div",Vs,[o[16]||(o[16]=e("label",{class:"block text-sm text-slate-300"},"Amount Paid",-1)),L(e("input",{"onUpdate:modelValue":o[5]||(o[5]=a=>$.value=a),type:"number",min:"0",max:A.value,step:"0.01",class:"mt-1 w-full rounded-md border dark-panel px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:text-slate-100"},null,8,Ns),[[ee,$.value,void 0,{number:!0}]]),e("div",Fs,[e("div",null,"Grand Total: ₹"+c(A.value.toFixed(2)),1),e("div",As,"Due: ₹"+c(ue.value.toFixed(2)),1)])])):F("",!0)])):F("",!0)])])]),E.value?(f(),be(ns,{key:0,items:J.value,subtotal:q.value,productDiscountTotal:Y.value,invoiceDiscountMode:d.mode,invoiceDiscountValue:d.value,invoiceDiscountAmount:z.value,grandTotal:A.value,onConfirm:Ne,onCancel:Fe},null,8,["items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","grandTotal"])):F("",!0),y.value&&s.value?(f(),be(Qe,{key:1,invoiceNumber:s.value.invoiceNumber,datetime:s.value.datetime,items:s.value.items,subtotal:s.value.subtotal,productDiscountTotal:s.value.productDiscountTotal,invoiceDiscountMode:s.value.invoiceDiscountMode,invoiceDiscountValue:s.value.invoiceDiscountValue,invoiceDiscountAmount:s.value.invoiceDiscountAmount,total:s.value.total,paymentType:s.value.paymentType,cashier:s.value.cashier,customerName:s.value.customerName,onClose:o[6]||(o[6]=a=>y.value=!1)},null,8,["invoiceNumber","datetime","items","subtotal","productDiscountTotal","invoiceDiscountMode","invoiceDiscountValue","invoiceDiscountAmount","total","paymentType","cashier","customerName"])):F("",!0),K.value?(f(),x("div",qs,[e("div",{class:"absolute inset-0 bg-black/40",onClick:o[7]||(o[7]=a=>K.value=!1)}),e("div",Rs,[e("div",Es,[o[17]||(o[17]=e("h3",{class:"text-lg font-semibold"},"Suspended Sales",-1)),e("button",{class:"text-sm text-gray-600",onClick:o[8]||(o[8]=a=>K.value=!1)},"Close")]),e("div",js,[L(e("input",{"onUpdate:modelValue":o[9]||(o[9]=a=>oe.value=a),type:"text",placeholder:"Search suspended sales or items...",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"},null,512),[[ee,oe.value]])]),I.value.length?(f(),x("ul",Os,[(f(!0),x(P,null,U(he.value,a=>(f(),x("li",{key:a.id,class:"rounded border p-3"},[e("div",zs,[e("div",Ls,[e("div",Bs,c(a.customerName||"Walk-in")+" — "+c(a.total.toFixed(2))+" Rs",1),e("div",Us,c(new Date(a.createdAt).toLocaleString()),1),e("div",Hs,[(f(!0),x(P,null,U(a.items,p=>(f(),x("div",{key:a.id+"_"+p.id},c(p.name)+" × "+c(p.quantity)+" — Rs "+c((p.price*p.quantity).toFixed(2)),1))),128))])]),e("div",Js,[e("button",{onClick:p=>we(a.id),class:"rounded bg-green-600 px-3 py-1 text-white text-sm"},"Resume",8,Ks),e("button",{onClick:p=>_e(a.id),class:"rounded border px-3 py-1 text-sm"},"Delete",8,Gs)])])]))),128))])):(f(),x("div",Ps,"No suspended sales."))])])):F("",!0),L(e("input",{ref_key:"scanInput",ref:R,"onUpdate:modelValue":o[10]||(o[10]=a=>Z.value=a),onKeydown:Ge(G($e,["prevent"]),["enter"]),"aria-hidden":"true",autocomplete:"off",tabindex:"-1",type:"text",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",opacity:"0"}},null,40,Qs),[[ee,Z.value]])],64)}}});export{oo as default};
