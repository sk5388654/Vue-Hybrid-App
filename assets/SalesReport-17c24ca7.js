import{d as H,k as J,j as K,J as Q,K as X,r as w,L as Y,c as i,y as Z,M as tt,o as n,a,b as t,n as h,C as u,G as L,N as et,f as j,t as o,F as p,e as g,w as st,v as ot,i as lt}from"./index-24020ea4.js";import{_ as nt}from"./RefundReceiptModal.vue_vue_type_script_setup_true_lang-dc73ae04.js";import"./print-d3c5ab14.js";const at={class:"view-layout"},dt={class:"flex flex-wrap gap-2"},it={key:0,class:"space-y-6"},rt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},ut={class:"view-card"},ct={class:"mt-2 text-2xl font-semibold text-slate-100"},vt={class:"view-card"},xt={class:"mt-2 text-2xl font-semibold text-red-600"},mt={class:"view-card"},ft={class:"view-card"},_t={class:"mt-2 text-2xl font-semibold text-slate-100"},ht={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},pt={class:"view-card"},gt={class:"mt-2 text-2xl font-semibold text-slate-100"},bt={class:"mt-1 text-xs text-slate-400"},yt={class:"view-card"},kt={class:"mt-2 text-2xl font-semibold text-slate-100"},wt={class:"mt-1 text-xs text-slate-400"},Tt={class:"view-card"},Rt={class:"mt-2 text-2xl font-semibold text-red-600"},St={class:"view-card"},Ct={key:0,class:"text-sm text-slate-400"},Nt={key:1,class:"grid grid-cols-2 gap-4 sm:grid-cols-5"},At={class:"text-xs text-slate-300"},Et={class:"mt-1 text-lg font-semibold text-red-600"},Bt={class:"view-card"},Mt={key:0,class:"text-sm text-slate-400"},Dt={key:1,class:"divide-y divide-gray-100"},It={class:"text-slate-200"},Lt={class:"font-medium text-slate-100"},jt={class:"view-card"},Vt={class:"mb-3 flex items-center justify-between"},Ft={class:"flex items-center gap-2"},$t={key:0,class:"text-sm text-slate-400"},qt={key:1,class:"divide-y divide-gray-100"},Pt={class:"text-slate-200"},Wt={class:"text-slate-300"},Ot={key:1,class:"space-y-6"},Ut={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},zt={class:"view-card"},Gt={class:"mt-2 text-2xl font-semibold text-orange-900"},Ht={class:"view-card"},Jt={class:"mt-2 text-2xl font-semibold text-orange-900"},Kt={class:"view-card"},Qt={class:"mt-2 text-2xl font-semibold text-orange-900"},Xt={class:"view-card"},Yt={class:"mt-2 text-xl font-semibold text-orange-900"},Zt={class:"view-card"},te={key:0,class:"text-sm text-slate-400"},ee={key:1,class:"overflow-hidden rounded-2xl border border-slate-100"},se={class:"table-modern"},oe={class:"text-right text-slate-300"},le={class:"text-right font-medium text-slate-100"},ne={class:"view-card"},ae={key:0,class:"text-sm text-slate-400"},de={key:1,class:"overflow-hidden rounded-2xl border border-slate-100"},ie={class:"max-h-[520px] overflow-auto"},re={class:"table-modern"},ue={class:"font-semibold text-slate-900"},ce={class:"text-right font-medium text-slate-900"},ve={class:"text-slate-500"},xe={class:"text-center"},me=["onClick"],ge=H({__name:"SalesReport",setup(fe){const c=J(),f=K(),v=Q(),T=X(),b=w(f.lowStockThreshold),V=Y(),y=w("overview"),C=i(()=>f.products.filter(l=>l.stock<b.value)),N=i(()=>c.todayTotal-v.expensesToday),A=i(()=>c.weekTotal-v.expensesThisWeek),E=i(()=>c.monthTotal-v.expensesThisMonth),B=i(()=>v.expensesByCategory),F=i(()=>{const l=B.value;return Object.keys(l).some(e=>l[e]!==0)}),_=i(()=>T.refundsForCurrentStore.slice().sort((l,e)=>new Date(e.createdAt).getTime()-new Date(l.createdAt).getTime())),M=i(()=>_.value.reduce((l,e)=>l+e.totalRefund,0)),R=i(()=>_.value.length),$=i(()=>{const l={};return _.value.forEach(e=>{const r=l[e.refundType]||{amount:0,count:0};r.amount+=e.totalRefund,r.count+=1,l[e.refundType]=r}),l}),k=i(()=>{const l=$.value;return Object.keys(l).map(r=>{const s=l[r]||{amount:0,count:0},m=r.replace(/_/g," ").replace(/\b\w/g,G=>G.toUpperCase());return{type:r,label:m,amount:s.amount,count:s.count}})}),q=i(()=>R.value?M.value/R.value:0),P=i(()=>{var e;return k.value.length?((e=[...k.value].sort((r,s)=>s.amount-r.amount)[0])==null?void 0:e.label)??"N/A":"N/A"}),S=w(!1),x=w(null),D=i(()=>x.value?c.sales.find(l=>{var e;return l.id===((e=x.value)==null?void 0:e.saleId)})??null:null),W=i(()=>x.value?T.refundsForSale(x.value.saleId):[]);function O(){f.setThreshold(b.value)}function d(l){return`₹${l.toFixed(2)}`}function I(l){y.value=l}function U(l){x.value=l,S.value=!0}function z(){S.value=!1,x.value=null}return Z(()=>{c.load(),f.load(),v.load(),T.load()}),(l,e)=>{const r=tt("router-link");return n(),a("div",at,[t("div",dt,[t("button",{class:h(["quick-filter",y.value==="overview"?"bg-blue-600 text-white border-blue-600":""]),type:"button",onClick:e[0]||(e[0]=s=>I("overview"))}," Overview ",2),t("button",{class:h(["quick-filter",y.value==="refunds"?"bg-amber-500 text-white border-amber-500":""]),type:"button",onClick:e[1]||(e[1]=s=>I("refunds"))}," Refunds ",2),u(V).isAdmin?(n(),L(r,{key:0,to:"/reports/employees",class:"quick-filter"},{default:et(()=>[...e[3]||(e[3]=[lt(" Employee Dashboard ",-1)])]),_:1})):j("",!0)]),y.value==="overview"?(n(),a("div",it,[t("div",rt,[t("div",ut,[e[4]||(e[4]=t("div",{class:"text-sm text-slate-400"},"Total Sales Today",-1)),t("div",ct,o(d(u(c).todayTotal)),1)]),t("div",vt,[e[5]||(e[5]=t("div",{class:"text-sm text-slate-400"},"Total Expenses Today",-1)),t("div",xt,o(d(u(v).expensesToday)),1)]),t("div",mt,[e[6]||(e[6]=t("div",{class:"text-sm text-slate-400"},"Profit/Loss Today",-1)),t("div",{class:h(["mt-2 text-2xl font-semibold",N.value>=0?"text-green-600":"text-red-600"])},o(d(N.value)),3)]),t("div",ft,[e[7]||(e[7]=t("div",{class:"text-sm text-slate-400"},"Products In Catalog",-1)),t("div",_t,o(u(f).products.length),1)])]),t("div",ht,[t("div",pt,[e[8]||(e[8]=t("div",{class:"text-sm text-slate-400"},"Sales This Week",-1)),t("div",gt,o(d(u(c).weekTotal)),1),t("div",bt,"Expenses: "+o(d(u(v).expensesThisWeek)),1),t("div",{class:h(["mt-1 text-sm font-medium",A.value>=0?"text-green-600":"text-red-600"])}," Net: "+o(d(A.value)),3)]),t("div",yt,[e[9]||(e[9]=t("div",{class:"text-sm text-slate-400"},"Sales This Month",-1)),t("div",kt,o(d(u(c).monthTotal)),1),t("div",wt,"Expenses: "+o(d(u(v).expensesThisMonth)),1),t("div",{class:h(["mt-1 text-sm font-medium",E.value>=0?"text-green-600":"text-red-600"])}," Net: "+o(d(E.value)),3)]),t("div",Tt,[e[10]||(e[10]=t("div",{class:"text-sm text-slate-400"},"Total Expenses",-1)),t("div",Rt,o(d(u(v).totalExpenses)),1)])]),t("div",St,[e[11]||(e[11]=t("h2",{class:"mb-3 text-lg font-semibold text-slate-100"},"Expenses by Category",-1)),F.value?(n(),a("div",Nt,[(n(!0),a(p,null,g(B.value,(s,m)=>(n(),a("div",{key:m,class:"rounded-2xl border border-slate-100 bg-slate-50 p-3"},[t("div",At,o(m),1),t("div",Et,o(d(s)),1)]))),128))])):(n(),a("div",Ct," No expenses recorded yet. "))]),t("div",Bt,[e[12]||(e[12]=t("h2",{class:"mb-3 text-lg font-semibold text-slate-100"},"Best Selling Items",-1)),u(c).bestSelling.length===0?(n(),a("div",Mt,"No sales yet.")):(n(),a("ul",Dt,[(n(!0),a(p,null,g(u(c).bestSelling,s=>(n(),a("li",{key:s.id,class:"flex items-center justify-between py-2 text-sm"},[t("span",It,o(s.name),1),t("span",Lt,"Qty: "+o(s.quantity),1)]))),128))]))]),t("div",jt,[t("div",Vt,[e[14]||(e[14]=t("h2",{class:"text-lg font-semibold text-slate-100"},"Low Stock Alerts",-1)),t("div",Ft,[e[13]||(e[13]=t("label",{class:"text-sm text-slate-300"},"Threshold",-1)),st(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),onChange:O,type:"number",min:"1",class:"input-field w-24"},null,544),[[ot,b.value,void 0,{number:!0}]])])]),C.value.length===0?(n(),a("div",$t,"No low-stock items.")):(n(),a("ul",qt,[(n(!0),a(p,null,g(C.value,s=>(n(),a("li",{key:s.id,class:"flex items-center justify-between py-2 text-sm"},[t("span",Pt,o(s.name),1),t("span",Wt,"Stock: "+o(s.stock),1)]))),128))]))])])):(n(),a("div",Ot,[t("div",Ut,[t("div",zt,[e[15]||(e[15]=t("div",{class:"text-sm text-orange-700"},"Total Refund Amount",-1)),t("div",Gt,o(d(M.value)),1)]),t("div",Ht,[e[16]||(e[16]=t("div",{class:"text-sm text-orange-700"},"Number of Refunds",-1)),t("div",Jt,o(R.value),1)]),t("div",Kt,[e[17]||(e[17]=t("div",{class:"text-sm text-orange-700"},"Average Refund Value",-1)),t("div",Qt,o(d(q.value)),1)]),t("div",Xt,[e[18]||(e[18]=t("div",{class:"text-sm text-orange-700"},"Top Refund Type",-1)),t("div",Yt,o(P.value),1)])]),t("div",Zt,[e[20]||(e[20]=t("h2",{class:"mb-3 text-lg font-semibold text-slate-100"},"Refund Breakdown by Type",-1)),k.value.length?(n(),a("div",ee,[t("table",se,[e[19]||(e[19]=t("thead",null,[t("tr",null,[t("th",null,"Type"),t("th",{class:"text-right"},"Count"),t("th",{class:"text-right"},"Amount (Rs)")])],-1)),t("tbody",null,[(n(!0),a(p,null,g(k.value,s=>(n(),a("tr",{key:s.type},[t("td",null,o(s.label),1),t("td",oe,o(s.count),1),t("td",le,o(d(s.amount)),1)]))),128))])])])):(n(),a("div",te," No refunds recorded for the selected store. "))]),t("div",ne,[e[22]||(e[22]=t("h2",{class:"mb-3 text-lg font-semibold text-slate-100"},"Recent Refunds",-1)),_.value.length===0?(n(),a("div",ae," No refunds recorded yet. ")):(n(),a("div",de,[t("div",ie,[t("table",re,[e[21]||(e[21]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Refund ID"),t("th",null,"Invoice"),t("th",null,"Type"),t("th",{class:"text-right"},"Amount (Rs)"),t("th",null,"Cashier"),t("th",null,"Reason"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(n(!0),a(p,null,g(_.value,s=>(n(),a("tr",{key:s.refundId},[t("td",null,o(new Date(s.createdAt).toLocaleString()),1),t("td",ue,o(s.refundId),1),t("td",null,"#"+o(s.invoiceNumber),1),t("td",null,o(s.refundType.replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase())),1),t("td",ce,o(d(s.totalRefund)),1),t("td",null,o(s.cashier),1),t("td",ve,o(s.refundReason||"—"),1),t("td",xe,[t("button",{class:"btn text-xs bg-amber-50 text-amber-700",type:"button",onClick:m=>U(s)}," View / Print Receipt ",8,me)])]))),128))])])])]))])])),S.value&&x.value&&D.value?(n(),L(nt,{key:2,refund:x.value,sale:D.value,existingRefunds:W.value,onClose:z},null,8,["refund","sale","existingRefunds"])):j("",!0)])}}});export{ge as default};
